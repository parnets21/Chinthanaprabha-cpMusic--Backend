import{j as e,i as W,p as q}from"../assets/index-B_jOc83F.js";import{r as a}from"./chunk-CTJ-xxG2.js";import{a as I}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const D="https://cpsangeetha.com/chinthanaprabha",X=()=>{var P,M,C,A;const[m,E]=a.useState([]),[F,b]=a.useState(!0),[y,j]=a.useState(null),[z,u]=a.useState(!1),[r,L]=a.useState(null),[h,U]=a.useState(""),[l,c]=a.useState(1),[p]=a.useState(10),[N,g]=a.useState(""),[w,v]=a.useState(!1),[R,V]=a.useState(""),[S,_]=a.useState("pending");a.useEffect(()=>{k()},[l]);const k=async()=>{try{b(!0);const t=await I.get(`${D}/reports`,{params:{page:l,limit:p}});E(t.data.data.reports||[]),j(null)}catch(t){console.error("Error fetching reports:",t),j("Failed to load reports. Please try again later.")}finally{b(!1)}},$=t=>{L(t),U("view"),u(!0)},B=async t=>{var n,d;t.preventDefault(),g(""),v(!0);try{const s=localStorage.getItem("adminId");if(!s){g("Admin ID not found. Please log in as an admin.");return}const o={status:S,adminNotes:R,reviewedBy:s},x=await I.put(`${D}/reports/${r._id}`,o);console.log("Report updated successfully:",x.data),u(!1),k()}catch(s){console.error("Error submitting report update:",s),g(((d=(n=s.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to update report. Please try again.")}finally{v(!1)}};if(F)return e.jsx("div",{className:"p-6 text-center",children:"Loading reports..."});if(y)return e.jsx("div",{className:"p-6 text-center text-red-500",children:y});const f=m.length>0?((P=m[0].pagination)==null?void 0:P.totalReports)||m.length:0,i=Math.ceil(f/p),T=()=>{const t=[],d=Math.floor(2.5);let s=Math.max(l-d,1);const o=Math.min(s+5-1,i);o-s+1<5&&(s=Math.max(o-5+1,1)),s>1&&(t.push(1),s>2&&t.push("..."));for(let x=s;x<=o;x++)t.push(x);return o<i&&(o<i-1&&t.push("..."),t.push(i)),t};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Report Management"})}),e.jsx("div",{className:"relative overflow-x-auto pb-4 scroll-container",style:{minWidth:"1200px"},children:e.jsx("div",{className:"min-w-full",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[120px]",children:"Report ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[150px]",children:"Reporter"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[150px]",children:"Reported User"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[180px]",children:"Course"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[200px]",children:"Reason"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[80px]",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium uppercase tracking-wider w-[120px]",children:"Created At"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:m.map(t=>{var n,d,s;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-3 py-2 text-sm font-medium text-gray-900 truncate max-w-[120px]",children:t._id}),e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-500 truncate max-w-[150px]",children:[((n=t.reporterId)==null?void 0:n.name)||"N/A"," (",t.reporterModel,")"]}),e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-500 truncate max-w-[150px]",children:[((d=t.reportedUserId)==null?void 0:d.name)||"N/A"," (",t.reportedUserModel,")"]}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-500 truncate max-w-[180px]",children:((s=t.courseId)==null?void 0:s.name)||"N/A"}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-500 truncate max-w-[200px]",children:t.reason}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-500 capitalize w-[80px]",children:t.status}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-500 truncate max-w-[120px]",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("div",{className:"flex justify-center space-x-2",children:e.jsx("button",{onClick:()=>$(t),className:"text-gray-600 hover:text-gray-800 p-1 rounded-full hover:bg-gray-50",title:"View Details",children:e.jsx(W,{size:18})})})})]},t._id)})})]})})}),e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 mt-4",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>c(t=>Math.max(t-1,1)),disabled:l===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>c(t=>Math.min(t+1,i)),disabled:l===i,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(l-1)*p+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(l*p,f)})," of"," ",e.jsx("span",{className:"font-medium",children:f})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>c(t=>Math.max(t-1,1)),disabled:l===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),T().map((t,n)=>t==="..."?e.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:"..."},`ellipsis-${n}`):e.jsx("button",{onClick:()=>c(t),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${l===t?"z-10 bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:t},t)),e.jsxs("button",{onClick:()=>c(t=>Math.min(t+1,i)),disabled:l===i,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})})]})]}),z&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-left",children:h==="view"?"Report Details":"Edit Report Status"}),N&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:N}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-left text-gray-700",children:"Reporter:"}),e.jsxs("p",{className:"mt-1 text-gray-900",children:[((M=r.reporterId)==null?void 0:M.name)||"N/A"," (",r.reporterModel,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-left text-gray-700",children:"Reported User:"}),e.jsxs("p",{className:"mt-1 text-gray-900",children:[((C=r.reportedUserId)==null?void 0:C.name)||"N/A"," (",r.reportedUserModel,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-left text-gray-700",children:"Course:"}),e.jsx("p",{className:"mt-1 text-gray-900",children:((A=r.courseId)==null?void 0:A.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-left text-gray-700",children:"Reason:"}),e.jsx("p",{className:"mt-1 text-gray-900",children:r.reason})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-left text-gray-700",children:"Description:"}),e.jsx("p",{className:"mt-1 text-gray-900",children:r.description||"No description provided."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-left text-gray-700",children:"Created At:"}),e.jsx("p",{className:"mt-1 text-gray-900",children:new Date(r.createdAt).toLocaleString()})]}),h==="edit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-left text-gray-700",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:S,onChange:t=>_(t.target.value),className:"mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"dismissed",children:"Dismissed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminNotes",className:"block text-sm font-medium text-left text-gray-700",children:"Admin Notes (optional)"}),e.jsx("textarea",{id:"adminNotes",name:"adminNotes",value:R,onChange:t=>V(t.target.value),rows:"4",className:"mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[h==="edit"&&e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:w,children:w?e.jsx(q,{className:"animate-spin mx-auto",size:20}):"Update Report"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 bg-gray-100 text-gray-600 px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Close"})]})]})]})})]})};export{X as default};
