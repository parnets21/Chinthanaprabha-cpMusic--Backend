import{j as e,S as K,P as q,d as R,a as ee,X as U,b as te,Z as se,_ as G}from"../assets/index-RuZLWH_6.js";import{r as x}from"./chunk-CTJ-xxG2.js";import{C as ae}from"./chunk-JoYx4iX8.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-ngrFHoWO.js";import"./chunk-nx6VVHRj.js";const H="https://cpsangeetha.com/api/order",xe=()=>{var O,P;const[J,v]=x.useState([]),[w,y]=x.useState(!1),[h,Q]=x.useState(""),[j,V]=x.useState("all"),[S,D]=x.useState(null),[C,F]=x.useState(""),[k,f]=x.useState(""),[r,A]=x.useState(null),T=async()=>{y(!0);try{const s=await(await fetch(H)).json();s.success?v(s.data):v([])}catch(t){console.error("Error fetching orders:",t),v([])}y(!1)};x.useEffect(()=>{T()},[]);const c=t=>{if(!t||!t.items||!Array.isArray(t.items))return{subtotal:t.total||0,discount:0,tax:0,gst:0,deliveryFee:0,total:t.total||0};if(t.subtotal!==void 0&&t.total!==void 0)return{subtotal:Number(t.subtotal)||0,discount:Number(t.discount)||0,tax:Number(t.tax)||0,gst:Number(t.gst)||0,deliveryFee:Number(t.deliveryFee)||0,total:Number(t.total)||0};let s=0,a=0,l=0,d=0,i=0;t.items.forEach(o=>{const b=Number(o.price)||0,p=Number(o.quantity)||1,u=b*p;s+=u;const g=Number(o.discount)||0,_=g>0?Math.round(u*g/100):0;a+=_;const L=u-_,$=Number(o.tax)||0,z=Number(o.gst)||0,B=Number(o.deliveryFee)||0;$>0&&(l+=Math.round(L*$/100)),z>0&&(d+=Math.round(L*z/100)),B>0&&(i+=B*p)});const m=s-a+l+d+i;return{subtotal:s,discount:a,tax:l,gst:d,deliveryFee:i,total:m}},W=t=>{const s=Number(t.price)||0,a=Number(t.quantity)||1,l=s*a,d=Number(t.discount)||0,i=d>0?Math.round(l*d/100):0,m=l-i,o=Number(t.tax)||0,b=Number(t.gst)||0,p=Number(t.deliveryFee)||0,u=o>0?Math.round(m*o/100):0,g=b>0?Math.round(m*b/100):0;return{subtotal:l,discount:i,discountedPrice:m,tax:u,gst:g,deliveryFee:p*a,total:m+u+g+p*a}},X=async t=>{if(C){y(!0);try{const s={status:C,isAdminAction:!0};k&&(s.estimatedDelivery=k);const l=await(await fetch(`${H}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();l.success?(T(),D(null),F(""),f("")):alert(l.message||"Failed to update order")}catch(s){console.error("Error updating order:",s),alert("Failed to update order")}y(!1)}},Y=t=>{A(t)},I=()=>{A(null)},E=J.filter(t=>{var l;const s=t._id.toLowerCase().includes(h.toLowerCase())||(((l=t.customer)==null?void 0:l.name)||"").toLowerCase().includes(h.toLowerCase())||(t.phone||"").toLowerCase().includes(h.toLowerCase()),a=j==="all"||t.status===j;return s&&a}),N=t=>{if(!t)return"N/A";try{const s=new Date(t);if(isNaN(s.getTime()))return"Invalid Date";const a={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return s.toLocaleDateString(void 0,a)}catch{return"Invalid Date"}},Z=t=>{if(!t)return"";try{const s=new Date(t);if(isNaN(s.getTime()))return"";const a=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0"),i=String(s.getHours()).padStart(2,"0"),m=String(s.getMinutes()).padStart(2,"0");return`${a}-${l}-${d}T${i}:${m}`}catch{return""}},n=t=>`₹${Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,M={pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6 width-full",children:e.jsxs("div",{className:"max-w-9xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Order Management"}),e.jsx("p",{className:"text-gray-600",children:"View and manage customer orders with delivery tracking"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6 flex flex-col md:flex-row gap-4 items-center justify-between",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 flex-1 w-full",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(K,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search by order ID, customer name or phone...",className:"pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:h,onChange:t=>Q(t.target.value)})]}),e.jsxs("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:j,onChange:t=>V(t.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-x-auto",children:w?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading orders..."})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estimated Delivery"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.length>0?E.map(t=>{var l,d;const s=c(t),a=((l=t.items)==null?void 0:l.length)||0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-4 w-4 text-gray-400 mr-2"}),"#",t._id.slice(-8)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((d=t.customer)==null?void 0:d.name)||"N/A"}),e.jsx("div",{className:"text-gray-500",children:t.customerModel||"User"}),t.cancelledBy&&t.status==="cancelled"&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Cancelled by: ",t.cancelledBy==="admin"?"Admin":"Customer"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium",children:[a," ",a===1?"item":"items"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.jsx("div",{children:e.jsx("div",{className:"text-lg font-bold text-green-600",children:n(s.total)})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:S===t._id?e.jsx("input",{type:"datetime-local",value:k,onChange:i=>f(i.target.value),className:"border px-2 py-1 rounded text-sm focus:ring-blue-500 focus:border-blue-500 w-48"}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-4 w-4 text-gray-400 mr-1"}),N(t.estimatedDelivery)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:S===t._id?e.jsxs("select",{value:C,onChange:i=>F(i.target.value),className:"border px-3 py-1 rounded text-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}):e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize ${M[t.status]||M.pending}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm flex gap-2",children:[S===t._id?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"flex items-center gap-1 bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm",onClick:()=>X(t._id),disabled:w,children:[e.jsx(ee,{size:16}),"Save"]}),e.jsxs("button",{className:"flex items-center gap-1 bg-gray-400 hover:bg-gray-500 text-white px-3 py-1 rounded text-sm",onClick:()=>{D(null),f("")},children:[e.jsx(U,{size:16}),"Cancel"]})]}):e.jsxs("button",{className:"flex items-center gap-1 bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-sm",onClick:()=>{D(t._id),F(t.status),f(Z(t.estimatedDelivery))},disabled:w,children:[e.jsx(te,{size:16}),"Edit"]}),e.jsxs("button",{className:"flex items-center gap-1 bg-gray-50 hover:bg-gray-100 text-gray-600 px-3 py-1 rounded text-sm",onClick:()=>Y(t),children:[e.jsx(se,{size:16}),"Details"]})]})]},t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-gray-400",children:h||j!=="all"?"No orders match your search criteria.":"No orders found. When orders are placed, they will appear here."})})})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Order Details #",r._id.slice(-8)]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:I,"aria-label":"Close modal",children:e.jsx(U,{size:24})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Order Items (",((O=r.items)==null?void 0:O.length)||0,")"]}),e.jsx("div",{className:"space-y-3",children:(P=r.items)==null?void 0:P.map((t,s)=>{const a=W(t);return e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.name||t.instrumentName||`Item ${s+1}`}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",t.quantity||1," × ",n(t.price||0)]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-green-600",children:n(a.total)})})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:n(a.subtotal)})]}),a.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:["Discount (",t.discount,"%):"]}),e.jsxs("span",{children:["-",n(a.discount)]})]}),a.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Tax (",t.tax,"%):"]}),e.jsx("span",{children:n(a.tax)})]}),a.gst>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["GST (",t.gst,"%):"]}),e.jsx("span",{children:n(a.gst)})]}),a.deliveryFee>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Fee:"}),e.jsx("span",{children:n(a.deliveryFee)})]})]})]},s)})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 mr-2"}),"Order Summary"]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:n(c(r).subtotal)})]}),c(r).discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-",n(c(r).discount)]})]}),c(r).tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"font-medium",children:n(c(r).tax)})]}),c(r).gst>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"GST:"}),e.jsx("span",{className:"font-medium",children:n(c(r).gst)})]}),c(r).deliveryFee>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Delivery Fee:"}),e.jsx("span",{className:"font-medium",children:n(c(r).deliveryFee)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-green-600",children:n(c(r).total)})]})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Shipping Information"]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Address:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:r.address||"N/A"})]}),r.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Phone:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:r.phone})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Payment Method:"}),e.jsx("p",{className:"text-gray-600 mt-1 capitalize",children:r.paymentMethod||"COD"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Estimated Delivery:"}),e.jsxs("p",{className:"text-gray-600 mt-1 flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),N(r.estimatedDelivery)]})]}),r.deliveryDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Actual Delivery:"}),e.jsxs("p",{className:"text-green-600 mt-1 flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),N(r.deliveryDate)]})]}),r.trackingId&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Tracking ID:"}),e.jsx("p",{className:"text-gray-600 mt-1 font-mono",children:r.trackingId})]}),r.cancellationReason&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-red-700",children:"Cancellation Reason:"}),e.jsx("p",{className:"text-red-600 mt-1",children:r.cancellationReason}),r.cancelledBy&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Cancelled by: ",r.cancelledBy==="admin"?"Admin":"Customer"]})]})]})]})]})]})}),e.jsx("div",{className:"p-6 border-t",children:e.jsx("button",{className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 w-full sm:w-auto",onClick:I,children:"Close"})})]})})]})})};export{xe as default};
