import{j as e,i as le,k as ie,f as $,l as ce,F as de}from"../assets/index-CwaGjddK.js";import{r as u}from"./chunk-CTJ-xxG2.js";import{a as p}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const fe=()=>{var W,G,Y;const[j,C]=u.useState([]),[k,I]=u.useState([]),[M,R]=u.useState(!1),[U,q]=u.useState(""),[B,f]=u.useState(!1),[x,S]=u.useState(""),[c,E]=u.useState(null),[a,h]=u.useState({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videos:[],videoUrls:[],lessonNumber:"",lessonIntro:""}]}),[y,V]=u.useState(!1),[A,N]=u.useState(0),[w,z]=u.useState(0),[b,J]=u.useState(1),[_]=u.useState(5);u.useEffect(()=>{D(),H()},[]);const g=async s=>{try{const t=await s;return console.log("API Response:",t.data),t}catch(t){throw console.error("API Error:",t.response?t.response.data:t.message),t}};u.useEffect(()=>{if(!y)return;let s,t=performance.now();const r=o=>{const i=Math.min(1e3,o-t);t=o;const d=A>=95?100:95,n=Math.max(A,Math.min(d,w+i/1e3*3)),m=w+(n-w)*.2;z(m),s=requestAnimationFrame(r)};return s=requestAnimationFrame(r),()=>cancelAnimationFrame(s)},[y,A,w]);const D=async()=>{try{const s=await g(p.get("https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses"));C(s.data)}catch(s){console.error("Error fetching courses:",s)}},H=async()=>{var s,t;try{R(!0),q("");const r=await g(p.get("https://cpsangeetha.com/chinthanaprabha/teacher-auth/teachers"));I(r.data||[])}catch(r){console.error("Error fetching teachers:",r),q(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load instructors"),I([])}finally{R(!1)}},O=b*_,K=O-_,Q=j.slice(K,O),L=Math.ceil(j.length/_),v=(s,t=-1)=>{const{name:r,value:o,type:i,files:d}=s.target;if(i==="file"){if(r==="image")h({...a,[r]:d[0]});else if(r==="videos"){const n=[...a.lessons];n[t].videos=[...n[t].videos,...d],h({...a,lessons:n})}}else if(t===-1)h({...a,[r]:o});else{const n=[...a.lessons];n[t][r]=o,h({...a,lessons:n})}},X=()=>{h({...a,lessons:[...a.lessons,{videos:[],videoUrls:[],lessonNumber:"",lessonIntro:""}]})},Z=s=>{const t=a.lessons.filter((r,o)=>o!==s);h({...a,lessons:t})},ee=()=>{S("add"),E(null),h({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videos:[],videoUrls:[],lessonNumber:"",lessonIntro:""}]}),f(!0)},se=s=>{var r;console.log("Editing course:",s);const t=s.lessons.map(o=>({lessonNumber:o.lessonNumber||"",lessonIntro:o.lessonIntro||"",videos:[],videoUrls:o.videoUrls||[],_id:o._id}));h({name:s.name||"",description:s.description||"",price:s.price||"",instructor:((r=s.instructor)==null?void 0:r._id)||s.instructor||"",image:null,currentImage:s.image,lessons:t.length>0?t:[{videos:[],videoUrls:[],lessonNumber:"",lessonIntro:""}]}),E(s),S("edit"),f(!0)},te=s=>{E({...s}),S("view"),f(!0)},re=async s=>{if(confirm("Are you sure you want to delete this course?"))try{await p.delete(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${s}`),C(j.filter(t=>t._id!==s))}catch(t){console.error("Error deleting course:",t)}},ae=async s=>{s.preventDefault();try{V(!0),N(0),z(0);let r=1+a.lessons.filter(i=>Array.isArray(i.videos)&&i.videos.length>0).length;if(x==="edit"){const i=a.lessons.filter(n=>n._id&&Array.isArray(n.videos)&&n.videos.length>0).length,d=a.lessons.filter(n=>!n._id&&Array.isArray(n.videos)&&n.videos.length>0).length;r=1+i+d}let o=0;if(x==="add"){const i=new FormData;i.append("name",a.name),i.append("description",a.description),i.append("price",a.price),i.append("instructor",a.instructor),a.image&&i.append("image",a.image);const n=(await g(p.post("https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses",i,{headers:{"Content-Type":"multipart/form-data"}}))).data._id;o+=1,N(Math.round(o/Math.max(r,1)*100));for(const m of a.lessons)if(m.videos&&m.videos.length>0){const l=new FormData;l.append("lessonNumber",m.lessonNumber),l.append("lessonIntro",m.lessonIntro),m.videos.forEach(P=>{l.append("videoUrls",P)}),await g(p.post(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${n}/lessons`,l,{headers:{"Content-Type":"multipart/form-data"}})),o+=1,N(Math.round(o/Math.max(r,1)*100))}}else if(x==="edit"){const i=c._id;try{const d=new FormData;d.append("name",a.name),d.append("description",a.description),d.append("price",a.price),d.append("instructor",a.instructor),a.image&&d.append("image",a.image),await g(p.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${i}`,d,{headers:{"Content-Type":"multipart/form-data"}})),o+=1,N(Math.round(o/Math.max(r,1)*100));for(const n of a.lessons)if(n._id){const m={lessonNumber:n.lessonNumber,lessonIntro:n.lessonIntro,videoUrls:n.videoUrls};if(n.videos&&n.videos.length>0){const l=new FormData;l.append("lessonNumber",n.lessonNumber),l.append("lessonIntro",n.lessonIntro),l.append("videoUrls",JSON.stringify(n.videoUrls)),n.videos.forEach(P=>{l.append("videoUrls",P)}),await g(p.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${n._id}`,l,{headers:{"Content-Type":"multipart/form-data"}})),o+=1,N(Math.round(o/Math.max(r,1)*100))}else await g(p.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${n._id}`,m))}else if(n.videos&&n.videos.length>0){const m=new FormData;m.append("lessonNumber",n.lessonNumber),m.append("lessonIntro",n.lessonIntro),n.videos.forEach(l=>{m.append("videoUrls",l)}),await g(p.post(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${i}/lessons`,m,{headers:{"Content-Type":"multipart/form-data"}})),o+=1,N(Math.round(o/Math.max(r,1)*100))}if(c.lessons){const n=a.lessons.filter(l=>l._id).map(l=>l._id),m=c.lessons.filter(l=>!n.includes(l._id));for(const l of m)console.log(`Deleting lesson ${l._id}`),await g(p.delete(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${l._id}`))}console.log("Course updated successfully"),f(!1),D()}catch(d){console.error("Error updating course:",d),alert("There was an error updating the course. Please try again.")}}f(!1),D()}catch(t){console.error("Error saving course:",t),alert("Error saving course. Please check the console for details.")}finally{V(!1)}},ne=(s,t)=>{const r=[...a.lessons],o=r[s].videoUrls[t];console.log(`Removing video: ${o}`),r[s].videoUrls.splice(t,1),h({...a,lessons:r})},oe=(s,t)=>{const r=[...a.lessons];r[s].videos.splice(t,1),h({...a,lessons:r})},F=s=>{J(s)};return e.jsxs("div",{className:"h-screen p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Course Management"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:ee,className:"bg-black text-white px-4 py-2 rounded",children:"Add New Course"})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white  ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800 text-white",children:[e.jsx("th",{className:"w-16 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Image"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Instructor"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Videos"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Lessons"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"w-32 px-4 py-2 text-centertext-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:Q.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-100 transition-colors duration-200",children:[e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",s._id.substring(0,6)]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx(T,{image:s.image,name:s.name})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:((t=s.instructor)==null?void 0:t.name)||s.instructor||"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-indigo-600",children:s.lessons.reduce((r,o)=>r+(o.videoUrls?o.videoUrls.length:0),0)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-indigo-600",children:s.lessons.length}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-bold text-gray-900",children:["â‚¹ ",s.price]}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-right text-sm font-medium space-x-3",children:[e.jsx("button",{onClick:()=>te(s),className:"text-indigo-600 hover:text-indigo-900",children:e.jsx(le,{size:18})}),e.jsx("button",{onClick:()=>se(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(ie,{size:18})}),e.jsx("button",{onClick:()=>re(s._id),className:"text-red-600 hover:text-red-900",children:e.jsx($,{size:18})})]})]},s._id)})})]})}),e.jsx("div",{className:"flex lg:justify-end justify start mt-4 mb-4 pr-4",children:e.jsxs("nav",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>F(Math.max(1,b-1)),disabled:b===1,className:`px-3 py-1 mx-1 rounded ${b===1?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Previous"}),Array.from({length:L},(s,t)=>t+1).map(s=>e.jsx("button",{onClick:()=>F(s),className:`px-3 py-1 mx-1 rounded ${b===s?"bg-black text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:s},s)),e.jsx("button",{onClick:()=>F(Math.min(L,b+1)),disabled:b===L,className:`px-3 py-1 mx-1 rounded ${b===L?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Next"})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg shadow-xl transform transition-all overflow-y-auto max-h-[85vh] relative",children:[e.jsx("button",{onClick:()=>f(!1),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-800 text-left",children:x==="view"?"Course Details":x==="add"?"Add New Course":"Edit Course"}),x==="view"&&c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Image"}),e.jsx(T,{image:c.image,name:c.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Name"}),e.jsx("p",{children:c.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"About Guru"}),e.jsx("p",{children:c.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Instructor"}),e.jsx("p",{children:((W=c.instructor)==null?void 0:W.name)||c.instructor||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Price"}),e.jsxs("p",{children:["â‚¹",c.price]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Lessons"}),e.jsx("ul",{className:"list-disc pl-5",children:(G=c==null?void 0:c.lessons)==null?void 0:G.map((s,t)=>e.jsxs("li",{children:["Lesson ",s.lessonNumber,": ",s.lessonIntro]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mt-2",children:(Y=c==null?void 0:c.lessons)==null?void 0:Y.flatMap(s=>{var t;return(t=s.videoUrls)==null?void 0:t.map((r,o)=>e.jsx("div",{children:e.jsxs("video",{controls:!0,className:"w-full h-auto",children:[e.jsx("source",{src:r,type:"video/mp4"}),"Your browser does not support the video tag."]})},o))})})]}),e.jsx("button",{onClick:()=>f(!1),className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Close"})]}):e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Course Image"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:v,className:"mt-1"}),x==="edit"&&a.currentImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current image:"}),e.jsx(T,{image:a.currentImage,name:a.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Course Name"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:v,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"About Guru"}),e.jsx("textarea",{name:"description",value:a.description,onChange:v,rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Instructor"}),e.jsxs("select",{name:"instructor",value:a.instructor,onChange:v,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:M?"Loading instructors...":"Select an instructor"}),U&&e.jsx("option",{value:"",disabled:!0,children:U}),!M&&!U&&k.length===0&&e.jsx("option",{value:"",disabled:!0,children:"No instructors found"}),!M&&!U&&k.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Price"}),e.jsx("input",{type:"number",name:"price",value:a.price,onChange:v,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Lessons"}),a.lessons.map((s,t)=>e.jsxs("div",{className:"mt-4 p-4 border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"text-lg font-medium text-left",children:["Lesson ",t+1]}),e.jsx("button",{type:"button",onClick:()=>Z(t),className:"text-red-600 hover:text-red-800",children:e.jsx(ce,{})})]}),e.jsx("input",{type:"text",placeholder:"Lesson Number",value:s.lessonNumber,onChange:r=>v(r,t),name:"lessonNumber",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2",required:!0}),e.jsx("input",{type:"text",placeholder:"Lesson Intro",value:s.lessonIntro,onChange:r=>v(r,t),name:"lessonIntro",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Videos"}),e.jsx("input",{type:"file",name:"videos",accept:"video/*",onChange:r=>v(r,t),className:"mt-1",multiple:!0}),s.videos.length>0&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"New videos to upload:"}),s.videos.map((r,o)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("video",{className:"w-24 h-auto mr-2",children:e.jsx("source",{src:URL.createObjectURL(r),type:"video/mp4"})}),e.jsx("button",{type:"button",onClick:()=>oe(t,o),className:"bg-red-500 text-white p-1 rounded-full",children:e.jsx($,{size:12})})]},o))]}),s.videoUrls&&s.videoUrls.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Existing videos:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.videoUrls.map((r,o)=>e.jsxs("div",{className:"relative",children:[e.jsxs("video",{controls:!0,className:"w-full h-auto",children:[e.jsx("source",{src:r,type:"video/mp4"}),"Your browser does not support the video tag."]}),e.jsx("button",{type:"button",onClick:()=>ne(t,o),className:"absolute top-0 right-0 bg-red-500 text-white p-1 rounded-full",children:e.jsx($,{size:12})})]},o))})]})]})]},t)),e.jsxs("button",{type:"button",onClick:X,className:"mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:[e.jsx(de,{className:"inline-block mr-2"})," Add Lesson"]})]}),e.jsxs("div",{className:"flex space-x-3 items-center",children:[e.jsx("button",{type:"submit",disabled:y,className:`flex-1 px-4 py-2 rounded text-white ${y?"bg-blue-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:y?`${x==="add"?"Adding":"Updating"}... ${Math.round(w)}%`:x==="add"?"Add Course":"Update Course"}),y&&e.jsx("div",{className:"w-40",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded transition-all duration-300 ease-out",style:{width:`${Math.round(w)}%`}})})}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400",children:"Cancel"})]})]})]})})]})},T=({image:j,name:C})=>{const[k,I]=u.useState(!1);return e.jsx("img",{src:k||!j?"/placeholder.svg":`${j}`,alt:C,className:"h-10 w-10 rounded-full",onError:()=>I(!0)})};export{fe as default};
