import{j as e}from"../assets/index-DYNONSj5.js";import{u as ye,b as ke,r as o}from"./chunk-CTJ-xxG2.js";import{a as N}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const y="https://cpsangeetha.com";function Ee(){var J,Q,X,Z;const b=ye(),m=ke(),{courseId:c,courseName:k,courseImage:ee}=b.state||{};o.useEffect(()=>{if(console.log("Videoweek component loaded"),console.log("Location state:",b.state),console.log("Course ID:",c),console.log("Course Name:",k),console.log("Current pathname:",b.pathname),!c){console.log("No courseId found, redirecting to admin performers"),m("/admin/performers",{replace:!0});return}},[c,m,b.state,b.pathname]);const[V,R]=o.useState([]),[we,se]=o.useState(null),[te,B]=o.useState(!0),[A,re]=o.useState(null),[u,ae]=o.useState(null),[n,z]=o.useState(null),[oe,D]=o.useState(!1),[ne,U]=o.useState(!1),[Ce,C]=o.useState(!1),[le,W]=o.useState(1),[F,T]=o.useState(!0),[I,L]=o.useState(!1),[g,ie]=o.useState(null),[v,S]=o.useState(""),[j,$]=o.useState(""),[p,ce]=o.useState({}),[P,M]=o.useState([]),[de,O]=o.useState(!1),[H,me]=o.useState(""),xe=o.useRef(null);o.useEffect(()=>{if(!c){m("/admin/performers");return}},[c,m]),o.useEffect(()=>{(()=>{try{const r=localStorage.getItem("token"),t=localStorage.getItem("userName"),h=localStorage.getItem("userEmail");if(r&&t&&h){const d="507f1f77bcf86cd799439011";ie(d),console.log("Admin logged in with ObjectId:",d)}else console.log("No admin login found"),m("/login")}catch(r){console.error("Error getting user info:",r),m("/login")}})()},[m]),o.useEffect(()=>{c&&w(!0)},[c]);const w=async(s=!1)=>{try{s?(C(!0),W(1),T(!0)):L(!0);const r=s?1:le;console.log("Fetching performers for course:",c,"page:",r);const t=await N.get(`${y}/chinthanaprabha/performers/course/${c}/top-performers?page=${r}&limit=10`);console.log("API Response:",t.data),t.data.weekInfo&&me(t.data.weekInfo);const f=(t.data.performers||[]).map((a,i)=>{var E;return console.log("Processing performer:",a.userName,"with",(E=a.videos)==null?void 0:E.length,"videos"),{...a,rank:a.rank||i+1,averageRating:a.averageRating||0,totalVideos:a.totalVideos||0,userName:a.userName||"Admin",userImage:a.userImage||"/placeholder.svg?height=50&width=50",stableId:`${a.userId}-${a.rank||i+1}-${c}`,videos:(a.videos||[]).map(l=>({...l,rating:l.rating||0,videoUrl:l.videoUrl||"",feedback:l.feedback||"",createdAt:l.createdAt||new Date().toISOString(),likes:l.likes||0,comments:l.comments||[]}))}}).sort((a,i)=>i.averageRating!==a.averageRating?i.averageRating-a.averageRating:a.userId.localeCompare(i.userId)).map((a,i)=>({...a,rank:i+1,stableId:`${a.userId}-${i+1}-${c}`}));R(s?f:a=>[...a,...f].filter((l,x,je)=>x===je.findIndex(Ne=>Ne.userId===l.userId)).sort((l,x)=>x.averageRating!==l.averageRating?x.averageRating-l.averageRating:l.userId.localeCompare(x.userId)).map((l,x)=>({...l,rank:x+1,stableId:`${l.userId}-${x+1}-${c}`}))),se(t.data.course),T(f.length===10),s||W(a=>a+1),B(!1),C(!1),L(!1)}catch(r){console.error("Error fetching performers:",r),re(r.message),B(!1),C(!1),L(!1)}},he=()=>{!I&&F&&w(!1)},ue=async s=>{O(!0);try{const r=await N.get(`${y}/chinthanaprabha/performers/video/${s}`);M(r.data.video.comments||[])}catch(r){console.error("Error fetching video comments:",r),M([])}finally{O(!1)}},_=async s=>{if(!g){alert("Please login to like videos");return}try{const r=await N.post(`${y}/chinthanaprabha/performers/video/${s}/like`,{userId:g});ce(t=>({...t,[s]:{count:r.data.likes,isLiked:r.data.isLiked}}))}catch(r){console.error("Error liking video:",r),alert("Failed to like video")}},q=async s=>{if(!g){alert("Please login to comment");return}if(!j.trim()){alert("Please enter a comment");return}try{const r=await N.post(`${y}/chinthanaprabha/performers/video/${s}/comment`,{userId:g,comment:j.trim()});$(""),alert("Comment added successfully")}catch(r){console.error("Error adding comment:",r),alert("Failed to add comment")}},K=async s=>{if(!g){alert("Please login to comment");return}if(!v.trim()){alert("Please enter a comment");return}try{const r=await N.post(`${y}/chinthanaprabha/performers/video/${s}/comment`,{userId:g,comment:v.trim()});M(t=>[...t,r.data.comment]),S(""),alert("Comment added successfully")}catch(r){console.error("Error adding comment:",r),alert("Failed to add comment")}},G=s=>{z(s),ue(s.videoId),U(!0)},ge=(s,r)=>{ae(s),z(r),S(""),$(""),D(!0)},Y=async(s,r)=>{try{const t={title:"Check out this amazing performer",text:`${s.userName}
Course: ${k}
Rating: ${r.rating}/5`,url:r.videoUrl};navigator.share?await navigator.share(t):(navigator.clipboard.writeText(`${t.text}
${t.url}`),alert("Link copied to clipboard!"))}catch(t){console.error("Error sharing video:",t)}},pe=(s,r)=>{const t=document.createElement("a");t.href=s,t.download=r||"video.mp4",document.body.appendChild(t),t.click(),document.body.removeChild(t)},fe=s=>new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),be=s=>{const r=[];for(let t=1;t<=5;t++)r.push(e.jsx("span",{className:`text-yellow-400 ${t<=s?"text-yellow-400":"text-gray-300"}`,children:"★"},t));return r},ve=(s,r=20)=>s&&s.length>r?s.substring(0,r)+"...":s;return te?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-3 text-lg",children:"Loading top performers..."})]}):A?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsxs("h3",{className:"text-xl font-semibold text-red-600 mb-2",children:["Error: ",A]}),e.jsx("button",{onClick:()=>w(!0),className:"bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Retry"})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>{console.log("Back button clicked, navigating to /admin/performers"),m("/admin/performers",{replace:!0})},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:ee||"/placeholder.svg",alt:k,className:"w-10 h-10 rounded-full border-2 border-purple-200 mr-3",onError:s=>{s.target.src="/placeholder.svg?height=40&width=40"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:ve(k)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Top Performers"})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("button",{onClick:()=>w(!0),className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})]})})}),H&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-2",children:e.jsx("p",{className:"text-center text-sm text-blue-700 italic",children:H})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:V.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No performers found"}),e.jsx("p",{className:"text-gray-500",children:"Be the first to submit a practice video this week!"})]}):e.jsxs("div",{className:"space-y-6",children:[V.map((s,r)=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3 ${s.rank<=3?"bg-yellow-500":"bg-orange-500"}`,children:s.rank}),e.jsx("img",{src:s.userImage||"/placeholder.svg",alt:s.userName,className:"w-12 h-12 rounded-full mr-4",onError:t=>{t.target.src="/placeholder.svg?height=48&width=48"}}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.userName})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:"Best Practice Video"}),s.videos&&s.videos.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.videos.map((t,h)=>{var d,f,a,i;return e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden cursor-pointer",onClick:()=>ge(s,t),children:[e.jsx("video",{className:"w-full h-48 object-cover",poster:"/placeholder.svg?height=192&width=300",children:e.jsx("source",{src:t.videoUrl,type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center group-hover:bg-opacity-30 transition-all",children:e.jsx("div",{className:"w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-800 ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm flex items-center",children:[e.jsx("span",{className:"text-yellow-400 mr-1",children:"★"}),t.rating]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 px-2",children:[e.jsxs("button",{onClick:()=>_(t.videoId),className:`flex items-center space-x-1 px-3 py-1 rounded-full text-sm transition-colors ${(d=p[t.videoId])!=null&&d.isLiked?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{children:(f=p[t.videoId])!=null&&f.isLiked?"❤️":"🤍"}),e.jsx("span",{children:((a=p[t.videoId])==null?void 0:a.count)||t.likes||0})]}),e.jsxs("button",{onClick:()=>G(t),className:"flex items-center space-x-1 px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",children:[e.jsx("span",{children:"💬"}),e.jsx("span",{children:((i=t.comments)==null?void 0:i.length)||0})]})]})]},t.videoId||h)})}):e.jsx("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsx("p",{children:"No practice videos available"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>Y(s,s.videos[0]),className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),e.jsx("span",{children:"Share"})]})})]})},s.stableId)),F&&e.jsx("div",{className:"text-center py-6",children:e.jsx("button",{onClick:he,disabled:I,className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:I?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Loading more..."]}):"Load More Performers"})})]})}),oe&&n&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Video Player"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("video",{ref:xe,className:"w-full h-64 md:h-96 bg-black rounded-lg",controls:!0,autoPlay:!0,children:[e.jsx("source",{src:n.videoUrl,type:"video/mp4"}),"Your browser does not support the video tag."]}),e.jsxs("div",{className:"flex items-center mt-4 mb-4",children:[e.jsx("img",{src:u.userImage||"/placeholder.svg",alt:u.userName,className:"w-12 h-12 rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:u.userName}),e.jsx("p",{className:"text-sm text-gray-600",children:fe(n.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex mr-2",children:be(n.rating)}),e.jsxs("span",{className:"text-sm text-gray-600",children:[n.rating,"/5"]})]}),n.feedback&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800 mb-1",children:"Instructor Feedback:"}),e.jsxs("p",{className:"text-sm text-blue-700",children:['"',n.feedback,'"']})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("button",{onClick:()=>_(n.videoId),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${(J=p[n.videoId])!=null&&J.isLiked?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{children:(Q=p[n.videoId])!=null&&Q.isLiked?"❤️":"🤍"}),e.jsxs("span",{children:[((X=p[n.videoId])==null?void 0:X.count)||n.likes||0," Likes"]})]}),e.jsxs("button",{onClick:()=>G(n),className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx("span",{children:"💬"}),e.jsxs("span",{children:[((Z=n.comments)==null?void 0:Z.length)||0," Comments"]})]}),e.jsxs("button",{onClick:()=>Y(u,n),className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),e.jsx("span",{children:"Share"})]}),e.jsxs("button",{onClick:()=>pe(n.videoUrl,`${u.userName}_${n.videoId}.mp4`),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),e.jsx("span",{children:"Download"})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:j,onChange:s=>$(s.target.value),placeholder:"Add a comment...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",onKeyPress:s=>{s.key==="Enter"&&j.trim()&&q(n.videoId)}}),e.jsx("button",{onClick:()=>q(n.videoId),disabled:!j.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})]})}),ne&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Comments (",P.length,")"]}),e.jsx("button",{onClick:()=>U(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:de?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-3",children:"Loading comments..."})]}):P.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"💬"}),e.jsx("p",{className:"font-semibold",children:"No comments yet"}),e.jsx("p",{className:"text-sm",children:"Be the first to comment!"})]}):e.jsx("div",{className:"space-y-4",children:P.map((s,r)=>{var t,h,d;return e.jsxs("div",{className:"flex space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("img",{src:((t=s.user)==null?void 0:t.image)||"/placeholder.svg?height=40&width=40",alt:((h=s.user)==null?void 0:h.name)||"User",className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:((d=s.user)==null?void 0:d.name)||"Admin"}),e.jsx("p",{className:"text-gray-700 text-sm mt-1",children:s.comment}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(s.createdAt).toLocaleDateString()})]})]},s._id||r)})})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:v,onChange:s=>S(s.target.value),placeholder:"Add a comment...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",onKeyPress:s=>{s.key==="Enter"&&v.trim()&&K(n.videoId)}}),e.jsx("button",{onClick:()=>K(n.videoId),disabled:!v.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})})]})}export{Ee as default};
