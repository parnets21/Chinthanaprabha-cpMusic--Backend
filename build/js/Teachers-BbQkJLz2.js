import{j as e,p as Z,q as ee,r as z,s as C,t as V,u as se,v as M,w as te,x as re,y as ae,z as le}from"../assets/index-CSJBBbQo.js";import{r as o}from"./chunk-CTJ-xxG2.js";import{a as f}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const h=f.create({baseURL:"https://cpsangeetha.com/chinthanaprabha",headers:{"Content-Type":"application/json"}});h.interceptors.request.use(l=>{const d=localStorage.getItem("token");return d&&(l.headers.Authorization=`Bearer ${d}`),l},l=>Promise.reject(l));const x={getAllTeachers:()=>h.get("/teacher/teachers"),getTeacherById:l=>h.get(`/teacher/teachers/${l}`),createTeacher:l=>h.post("/teacher/teachers",l),updateTeacher:(l,d)=>h.put(`/teacher/teachers/${l}`,d,{headers:{"Content-Type":"multipart/form-data"}}),deleteTeacher:l=>h.delete(`/teacher/teachers/${l}`),likeTeacher:(l,d)=>h.post(`/teacher/teachers/${l}/like`,{userId:d}),addComment:(l,d,y)=>f.post(`https://cpsangeetha.com/chinthanaprabha/teacher/teachers/${l}/comments`,{userId:d,text:y},{headers:{"Content-Type":"application/json"}}),getComments:l=>h.get(`/teacher/teachers/${l}/comments`),deleteComment:(l,d)=>h.delete(`/teacher/teachers/${l}/comments/${d}`)},xe=()=>{var q,R;const[l,d]=o.useState([]),[y,j]=o.useState(!0),[S,U]=o.useState(null),[n,p]=o.useState(null),[v,F]=o.useState(""),[ne,N]=o.useState(!1),[w,k]=o.useState(!1),H=o.useRef(null),[O,g]=o.useState(!1),[u,E]=o.useState(!1),[r,b]=o.useState({subject:"",name:"",subjectImage:null,videoUrl:null}),[i,T]=o.useState(null),[ce,_]=o.useState(!0);o.useEffect(()=>{I(),W()},[]);const W=async()=>{try{_(!0);const s=localStorage.getItem("userId");if(s){const t=await f.get(`https://cpsangeetha.com/chinthanaprabha/user-auth/user/${s}`);T(t.data)}else T({_id:"user123",name:"Demo User"})}catch(s){console.error("Error fetching current user:",s),T({_id:"user123",name:"Demo User"})}finally{_(!1)}},I=async()=>{try{j(!0);const s=await x.getAllTeachers();d(s.data)}catch(s){console.error("Error fetching teachers:",s),U("Failed to load teachers. Please try again later.")}finally{j(!1)}},$=async s=>{try{j(!0);const t=await x.getTeacherById(s),c=await x.getComments(s);if(p({...t.data,comments:c.data}),i&&t.data.likes){const a=t.data.likes.find(m=>m.userId===i._id&&m.videoId===t.data.videoUrl);k(!!a)}}catch(t){console.error("Error fetching teacher:",t),U("Failed to load teacher details. Please try again later.")}finally{j(!1)}},L=()=>{p(null),F(""),k(!1)},X=async()=>{if(!i){alert("Please login to like videos");return}try{const s=await x.likeTeacher(n._id,i._id);p(s.data.teacher),k(!w)}catch(s){console.error("Error liking video:",s)}},Y=async s=>{if(s.preventDefault(),!i){alert("Please login to comment");return}if(v.trim())try{N(!0),console.log("Submitting comment with data:",{teacherId:n._id,userId:i._id,text:v}),await x.addComment(n._id,i._id,v),setTimeout(async()=>{try{const t=await x.getTeacherById(n._id);p(t.data),F("")}catch(t){console.error("Error fetching updated teacher:",t)}finally{N(!1)}},500)}catch(t){console.error("Error submitting comment:",t),t.response&&(console.error("Response data:",t.response.data),console.error("Response status:",t.response.status)),alert("Failed to add comment. Please try again."),N(!1)}},G=async s=>{try{const t=await x.deleteComment(n._id,s);p(t.data)}catch(t){console.error("Error deleting comment:",t)}},D=()=>{E(!1),b({subject:"",name:"",subjectImage:null,videoUrl:null}),g(!0)},J=s=>{E(!0),b({id:s._id,subject:s.subject,name:s.name,subjectImage:null,videoUrl:null}),g(!0)},K=async s=>{if(window.confirm("Are you sure you want to delete this teacher?"))try{await x.deleteTeacher(s),I(),n&&n._id===s&&L()}catch(t){console.error("Error deleting teacher:",t),alert("Failed to delete teacher. Please try again.")}},P=s=>{const{name:t,value:c}=s.target;b({...r,[t]:c})},A=s=>{const{name:t,files:c}=s.target;c&&c.length>0&&(console.log(`File selected for ${t}:`,c[0].name),b({...r,[t]:c[0]}))},Q=async s=>{var t,c;if(s.preventDefault(),!r.subject||!r.name){alert("Please fill in all required fields");return}if(!u&&(!r.subjectImage||!r.videoUrl)){alert("Please upload both subject image and video");return}if(r.subjectImage&&!r.subjectImage.type.startsWith("image/")){alert("Please upload only image files for the subject image");return}if(r.videoUrl&&!r.videoUrl.type.startsWith("video/")){alert("Please upload only video files for the video");return}try{const a=new FormData;a.append("subject",r.subject),a.append("name",r.name),r.subjectImage&&a.append("subjectImage",r.subjectImage),r.videoUrl&&a.append("videoUrl",r.videoUrl),console.log("Form data being sent:",{subject:r.subject,name:r.name,hasSubjectImage:!!r.subjectImage,hasVideoUrl:!!r.videoUrl,subjectImageType:r.subjectImage?r.subjectImage.type:null,videoUrlType:r.videoUrl?r.videoUrl.type:null});let m;u?(m=await f.put(`https://cpsangeetha.com/chinthanaprabha/teacher/teachers/${r.id}`,a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")||""}`}}),console.log("Server response:",m.data),alert("Teacher updated successfully!")):(m=await f({method:"post",url:"https://cpsangeetha.com/chinthanaprabha/teacher/teachers",data:a,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")||""}`}}),console.log("Server response:",m.data),alert("Teacher added successfully!")),g(!1),I()}catch(a){console.error("Error saving teacher:",a),a.response?(console.error("Response data:",a.response.data),console.error("Response status:",a.response.status),console.error("Response headers:",a.response.headers)):a.request?console.error("Request made but no response received:",a.request):console.error("Error setting up request:",a.message),alert(`Failed to save teacher: ${((c=(t=a.response)==null?void 0:t.data)==null?void 0:c.message)||a.message||"Please try again."}`)}};return y&&!n?e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx(Z,{className:"animate-spin h-8 w-8 text-purple-600"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading..."})]}):S?e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mx-auto max-w-4xl my-8",children:e.jsx("p",{children:S})}):n?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("button",{onClick:L,className:"flex items-center text-black hover:text-purple-800",children:[e.jsx(ee,{className:"mr-1"})," Back to Teachers"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n.subject}),e.jsxs("p",{className:"text-lg text-gray-600 mt-2",children:["Instructor: ",n.name]})]}),e.jsx("div",{className:"aspect-video bg-black",children:e.jsx("video",{ref:H,src:`${n.videoUrl}`,className:"w-full h-full object-contain",controls:!0,poster:`${n.subjectImage}`,onError:s=>{console.error("Video error:",s),s.target.onerror=null}})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs("button",{onClick:X,className:`flex items-center space-x-1 px-4 py-2 rounded-full ${w?"bg-pink-100 text-pink-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(z,{className:w?"fill-current":""}),e.jsxs("span",{children:[((q=n.likes)==null?void 0:q.length)||0," Likes"]})]}),e.jsxs("button",{onClick:()=>document.getElementById("comment-input").focus(),className:"flex items-center space-x-1 px-4 py-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200",children:[e.jsx(C,{}),e.jsxs("span",{children:[((R=n.comments)==null?void 0:R.length)||0," Comments"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Comments"}),e.jsx("form",{onSubmit:Y,className:"mb-6 flex items-center gap-3",children:e.jsx("div",{className:" flex-shrink-0 flex items-center justify-center overflow-hidden",children:i&&i.image&&e.jsx("img",{src:`${i.image}`,alt:i.name,className:"w-full h-full object-cover",onError:s=>{s.target.onerror=null}})})}),e.jsx("div",{className:"space-y-4",children:n.comments&&n.comments.length>0?n.comments.map(s=>{const t=s.userId&&typeof s.userId=="object",c=t?s.userId.name:"Unknown User",a=t?s.userId._id:s.userId;let m=null;return t&&s.userId.image&&(m=`${s.userId.image}`),e.jsxs("div",{className:"flex space-x-3 py-3 group border-b border-gray-100 last:border-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex-shrink-0 flex items-center justify-center overflow-hidden",children:m?e.jsx("img",{src:m||"/placeholder.svg",alt:c,className:"w-full h-full object-cover",onError:B=>{console.log("Image failed to load:",m),B.target.onerror=null,B.target.src="/placeholder.svg?height=40&width=40"}}):e.jsx(V,{className:"text-gray-600",size:20})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex flex-wrap items-start",children:[e.jsx("span",{className:"font-semibold text-sm mr-2",children:c}),e.jsx("span",{className:"text-sm text-gray-700",children:s.text})]}),e.jsxs("div",{className:"flex items-center mt-2 text-xs text-gray-500 space-x-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"mr-1",size:12}),new Date(s.createdAt).toLocaleString()]}),e.jsx("button",{className:"font-medium text-gray-500 hover:text-gray-700",children:"Like"}),e.jsx("button",{className:"font-medium text-gray-500 hover:text-gray-700",children:"Reply"}),i&&i._id===a&&e.jsx("button",{onClick:()=>G(s._id),className:"text-gray-500 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:"Delete"})]})]})]},s._id)}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(C,{className:"mx-auto text-gray-400 mb-3",size:40}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No comments yet"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Be the first to share what you think!"})]})})]})]})]})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Our Teachers"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Learn from our expert teachers in various subjects"})]}),e.jsxs("button",{onClick:D,className:"flex items-center bg-gradient-to-b from-[#0D0D0D] via-[#8B0000] to-[#0D0D0D] text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(M,{className:"mr-2"})," Add Teacher"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(s=>{var t,c;return e.jsx("div",{className:"group",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:shadow-xl hover:-translate-y-1",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200 cursor-pointer",onClick:()=>$(s._id),children:[e.jsx("img",{src:`${s.subjectImage}`,alt:s.subject,className:"w-full h-full object-cover",onError:a=>{a.target.onerror=null,a.target.src="/placeholder.svg?height=200&width=300"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end",children:e.jsx("div",{className:"p-4 text-white",children:e.jsx("h3",{className:"text-xl font-semibold",children:s.subject})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(V,{className:"text-purple-600 mr-2"}),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"mr-1"}),e.jsxs("span",{children:[((t=s.likes)==null?void 0:t.length)||0," likes"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"mr-1"}),e.jsxs("span",{children:[((c=s.comments)==null?void 0:c.length)||0," comments"]})]}),e.jsxs("div",{className:"flex items-center cursor-pointer text-purple-600 hover:text-purple-800",onClick:()=>$(s._id),children:[e.jsx(te,{className:"mr-1"}),e.jsx("span",{children:"View"})]})]}),e.jsxs("div",{className:"flex justify-between mt-4 pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>J(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx(re,{})}),e.jsx("button",{onClick:()=>K(s._id),className:"text-red-600 hover:text-red-800",children:e.jsx(ae,{})})]})]})]})},s._id)})}),l.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"No teachers found."}),e.jsxs("button",{onClick:D,className:"flex items-center mx-auto bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:[e.jsx(M,{className:"mr-1"})," Add Your First Teacher"]})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold",children:u?"Edit Teacher":"Add New Teacher"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(le,{size:24})})]}),e.jsxs("form",{onSubmit:Q,className:"p-6",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-1",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:r.subject,onChange:P,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Teacher Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:r.name,onChange:P,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"subjectImage",className:"block text-sm font-medium text-gray-700 mb-1",children:["Subject Image"," ",!u&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",id:"subjectImage",name:"subjectImage",accept:"image/*",onChange:A,required:!u,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),u&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to keep the current image"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"videoUrl",className:"block text-sm font-medium text-gray-700 mb-1",children:["Video File"," ",!u&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",id:"videoUrl",name:"videoUrl",accept:"video/*",onChange:A,required:!u,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),u&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to keep the current video"})]})]}),e.jsxs("div",{className:"flex justify-end mt-8 space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:u?"Update Teacher":"Add Teacher"})]})]})]})})]})};export{xe as default};
