import{j as e,i as as,k as ns,f as Be,l as ls,F as is}from"../assets/index-C1tyMXyH.js";import{r as u}from"./chunk-CTJ-xxG2.js";import{a as F}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const xs=()=>{var Se,Ue,ke;const[S,H]=u.useState([]),[G,Q]=u.useState(!0),[X,ge]=u.useState(""),[fe,be]=u.useState([]),[re,ve]=u.useState(!1),[Z,je]=u.useState(""),[_e,T]=u.useState(!1),[N,oe]=u.useState(""),[h,ae]=u.useState(null),[a,w]=u.useState({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videoFiles:[],lessonNumber:"",lessonIntro:""}]}),[Ne,A]=u.useState({}),[we,$]=u.useState({}),[ye,B]=u.useState({}),[Fe,_]=u.useState({}),[Re,R]=u.useState({}),[Ve,ne]=u.useState({}),[K,le]=u.useState({}),[V,$e]=u.useState(!1),[ie,z]=u.useState(0),[O,Ee]=u.useState(0),[M,ze]=u.useState(1),[ce]=u.useState(5);u.useEffect(()=>{me(),Je()},[]),u.useEffect(()=>()=>{Object.keys(K).forEach(s=>{const t=K[s];t&&(t.abort(),console.log(`Cancelled upload ${s} on component unmount`))})},[K]);const de=async(s,t,r,o=0)=>{var m,d,v,l,x,i,I,he,Me,Pe,Ie,Te,Ae,De;const c=Date.now();A(n=>({...n,[t]:!0})),$(n=>({...n,[t]:0}));try{const n=new FormData;n.append("video",s),console.log(`Uploading ${s.name} - Attempt ${o+1}/2`);const p=await F.post(r,n,{timeout:600*1e3,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:E=>{const C=E.loaded,W=E.total,q=Math.round(C*100/W),pe=(Date.now()-c)/1e3,J=C/Math.max(pe,1),b=(W-C)/Math.max(J,1);$(g=>({...g,[t]:q})),B(g=>({...g,[t]:J})),_(g=>({...g,[t]:b})),R(g=>({...g,[t]:C})),ne(g=>({...g,[t]:W})),q%25===0&&q>0&&console.log(`Progress: ${q}% - Speed: ${U(J)}/s - ETA: ${Math.round(b)}s`)}});if(console.log(`✅ Upload completed: ${s.name}`),console.log("📋 Response data:",p.data),!p.data.location)throw new Error("No video URL returned from server");return $(E=>({...E,[t]:100})),A(E=>({...E,[t]:!1})),p.data.location}catch(n){if(console.error(`Upload failed (attempt ${o+1}):`,n.message),o<1&&((m=n.message)!=null&&m.includes("timeout")||(d=n.message)!=null&&d.includes("ECONNRESET")||(v=n.message)!=null&&v.includes("Network Error")))return console.log("Retrying in 5 seconds..."),await new Promise(p=>setTimeout(p,5e3)),de(s,t,r,o+1);throw A(p=>({...p,[t]:!1})),n}try{const n=new FormData;n.append("video",s),console.log(`Uploading ${s.name} (${U(fileSize)}) - Attempt ${o+1}/2`);const p=new AbortController;le(j=>({...j,[t]:p}));const E=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=new EventSource(`https://cpsangeetha.com/api/upload-progress/${E}`);C.onmessage=j=>{try{const b=JSON.parse(j.data);if(b.type==="progress"){const g=b.progress,y=g.uploadedBytes,se=g.totalBytes,Y=g.percentage,Le=(Date.now()-c)/1e3,te=y/Le,os=(se-y)/te;$(L=>({...L,[t]:Y})),B(L=>({...L,[t]:te})),_(L=>({...L,[t]:os})),R(L=>({...L,[t]:y})),console.log(`📊 SSE Progress for ${s.name}: ${Y}% (${U(y)}/${U(se)})`)}else{if(b.type==="completed")return console.log("🎉 Upload completed via SSE:",b),C.close(),$(g=>({...g,[t]:100})),A(g=>({...g,[t]:!1})),b.videoUrl;b.type==="connected"&&console.log("📡 SSE connected for upload:",E)}}catch(b){console.error("Error parsing SSE data:",b)}},C.onerror=j=>{console.error("SSE connection error:",j),C.close()};const W=F.create({timeout:7200*1e3,headers:{"Content-Type":"multipart/form-data"},signal:p.signal,onUploadProgress:j=>{const b=j.loaded,g=j.total,y=Math.round(b*100/g),se=(Date.now()-c)/1e3,Y=b/se,te=(g-b)/Y;if($(k=>({...k,[t]:y})),B(k=>({...k,[t]:Y})),_(k=>({...k,[t]:te})),R(k=>({...k,[t]:b})),y%10===0&&y>0&&console.log(`Upload progress for ${s.name}: ${y}% (${U(b)}/${U(g)})`),y>0&&y<100)try{fetch("https://cpsangeetha.com/api/heartbeat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({timestamp:Date.now()})}).catch(()=>{})}catch{}}});n.append("uploadId",E);const q=W.post(r,n),pe=new Promise((j,b)=>{setTimeout(()=>b(new Error("Upload timeout - server under high load")),3e5)}),J=await Promise.race([q,pe]);return console.log(`Successfully uploaded ${s.name}`),C.close(),$(j=>({...j,[t]:100})),A(j=>({...j,[t]:!1})),J.data.location}catch(n){if(console.error(`Upload attempt ${o+1} failed for ${s.name}:`,n),n.name==="AbortError"||n.code==="ERR_CANCELED")throw console.log(`Upload cancelled for ${s.name}`),new Error("Upload cancelled by user");if(o<1&&(n.code==="ECONNABORTED"||n.code==="ECONNRESET"||n.code==="ETIMEDOUT"||((l=n.response)==null?void 0:l.status)===500||((x=n.response)==null?void 0:x.status)===502||((i=n.response)==null?void 0:i.status)===503||((I=n.response)==null?void 0:I.status)===504||(he=n.message)!=null&&he.includes("timeout")||(Me=n.message)!=null&&Me.includes("Network Error")))return console.log(`Retrying upload for ${s.name} in 5 seconds... (Attempt ${o+2}/2)`),$(p=>({...p,[t]:0})),B(p=>({...p,[t]:0})),_(p=>({...p,[t]:0})),R(p=>({...p,[t]:0})),await new Promise(p=>setTimeout(p,5e3)),de(s,t,r,o+1);throw n.code==="ECONNABORTED"||(Pe=n.message)!=null&&Pe.includes("timeout")?new Error("Upload timeout - file too large or connection too slow. Please check your internet connection and try again."):n.code==="ECONNRESET"?new Error("Connection lost during upload. Please try again."):((Ie=n.response)==null?void 0:Ie.status)===413?new Error("File too large - maximum size is 10GB"):((Te=n.response)==null?void 0:Te.status)>=500?new Error("Server error during upload - please try again in a few minutes"):((Ae=n.response)==null?void 0:Ae.status)===400?new Error("Invalid file format - please upload a video file"):(De=n.message)!=null&&De.includes("Network Error")?new Error("Network error - please check your internet connection"):new Error(`Upload failed: ${n.message}`)}finally{A(n=>({...n,[t]:!1})),le(n=>{const p={...n};return delete p[t],p}),setTimeout(()=>{$(n=>({...n,[t]:0})),B(n=>({...n,[t]:0})),_(n=>({...n,[t]:0})),R(n=>({...n,[t]:0})),ne(n=>({...n,[t]:0}))},5e3)}},Oe=async(s,t)=>{try{const r=Array.from(t.target.files);if(!r.length)return;const o=[],f=[];if(r.forEach(c=>{if(!c.type.startsWith("video/")){f.push(`${c.name} - Not a video file`);return}if(c.size>10*1024*1024*1024){f.push(`${c.name} - File too large (max 10GB)`);return}o.push(c)}),f.length>0&&alert(`Invalid files:
${f.join(`
`)}`),o.length>0){const c=[];for(let m=0;m<o.length;m++){const d=o[m],v=`lesson-${s}-file-${m}`;try{const l=await de(d,v,"https://cpsangeetha.com/chinthanaprabha/upload-video-direct");c.push({...d,url:l})}catch(l){console.error(`Failed to upload ${d.name}:`,l),alert(`Failed to upload ${d.name}. Please try again.`)}}c.length>0&&(w(m=>({...m,lessons:m.lessons.map((d,v)=>v===s?{...d,videoFiles:[...d.videoFiles||[],...c]}:d)})),c.length===1?alert(`Successfully uploaded: ${c[0].name}`):alert(`Successfully uploaded ${c.length} video files`))}t.target.value=""}catch(r){console.error("Error handling video file change:",r),alert("Error adding video files. Please try again.")}},qe=(s,t)=>{try{w(r=>({...r,lessons:r.lessons.map((o,f)=>f===s?{...o,videoFiles:(o.videoFiles||[]).filter((c,m)=>m!==t)}:o)}))}catch(r){console.error("Error removing video file:",r),alert("Error removing video file. Please try again.")}},Ge=s=>{try{window.confirm("Are you sure you want to remove all videos from this lesson?")&&w(t=>({...t,lessons:t.lessons.map((r,o)=>o===s?{...r,videoFiles:[]}:r)}))}catch(t){console.error("Error clearing all videos:",t),alert("Error clearing videos. Please try again.")}},We=s=>{try{const t=K[s];t&&(t.abort(),console.log(`Upload cancelled for ${s}`),A(r=>({...r,[s]:!1})),$(r=>({...r,[s]:0})),B(r=>({...r,[s]:0})),_(r=>({...r,[s]:0})),R(r=>({...r,[s]:0})),ne(r=>({...r,[s]:0})),le(r=>{const o={...r};return delete o[s],o}),alert("Upload cancelled successfully"))}catch(t){console.error("Error cancelling upload:",t),alert("Error cancelling upload. Please try again.")}},P=async s=>{try{const t=await s;return console.log("API Response:",t.data),t}catch(t){throw console.error("API Error:",t.response?t.response.data:t.message),t}};u.useEffect(()=>{if(!V)return;let s,t=performance.now();const r=o=>{const f=Math.min(1e3,o-t);t=o;const c=ie>=95?100:95,m=Math.max(ie,Math.min(c,O+f/1e3*3)),d=O+(m-O)*.2;Ee(d),s=requestAnimationFrame(r)};return s=requestAnimationFrame(r),()=>cancelAnimationFrame(s)},[V,ie,O]);const me=async()=>{try{console.log("Starting to fetch courses..."),Q(!0),ge("");const s=await P(F.get("https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses"));console.log("Courses fetched successfully:",s.data,"courses"),H(s.data)}catch(s){console.error("Error fetching courses:",s),ge("Failed to load courses")}finally{Q(!1)}},Je=async()=>{var s,t;try{ve(!0),je("");const r=await P(F.get("https://cpsangeetha.com/chinthanaprabha/teacher-auth/teachers"));be(r.data||[])}catch(r){console.error("Error fetching teachers:",r),je(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load instructors"),be([])}finally{ve(!1)}},Ce=M*ce,Ye=Ce-ce,He=S.slice(Ye,Ce),ee=Math.ceil(S.length/ce),D=async(s,t=-1)=>{const{name:r,value:o,type:f,files:c}=s.target;if(f==="file")r==="image"?w({...a,[r]:c[0]}):r==="courseVideo"&&console.log("Course video upload functionality has been removed");else if(t===-1)w({...a,[r]:o});else{const m=[...a.lessons];m[t][r]=o,w({...a,lessons:m})}},Qe=()=>{w({...a,lessons:[...a.lessons,{videoFiles:[],lessonNumber:"",lessonIntro:""}]})},Xe=s=>{const t=a.lessons.filter((r,o)=>o!==s);w({...a,lessons:t})},Ze=()=>{oe("add"),ae(null),w({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videoUrls:[],lessonNumber:"",lessonIntro:""}]}),T(!0)},Ke=s=>{var r;console.log("Editing course:",s);const t=s.lessons.map(o=>{const f=o.videoUrls?o.videoUrls.map(c=>({url:c,name:c.split("/").pop()||"Existing Video",size:0,type:"video/mp4"})):[];return{lessonNumber:o.lessonNumber||"",lessonIntro:o.lessonIntro||"",videoFiles:f,_id:o._id}});w({name:s.name||"",description:s.description||"",price:s.price||"",instructor:((r=s.instructor)==null?void 0:r._id)||s.instructor||"",image:null,currentImage:s.image,lessons:t.length>0?t:[{videoFiles:[],lessonNumber:"",lessonIntro:""}]}),ae(s),oe("edit"),T(!0)},es=s=>{ae({...s}),oe("view"),T(!0)},ss=async s=>{if(confirm("Are you sure you want to delete this course?"))try{await F.delete(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${s}`),H(S.filter(t=>t._id!==s))}catch(t){console.error("Error deleting course:",t)}},ts=async s=>{var t,r,o;if(s.preventDefault(),!a.name||!a.description||!a.price||!a.instructor){alert("Please fill in all required fields (Name, Description, Price, Instructor)");return}if(!a.image){alert("Please select a course image");return}console.log("Form data validation passed:",{name:a.name,description:a.description,price:a.price,instructor:a.instructor,hasImage:!!a.image,imageType:(t=a.image)==null?void 0:t.type,imageSize:(r=a.image)==null?void 0:r.size});try{$e(!0),z(0),Ee(0);let c=1+a.lessons.filter(d=>d.videoFiles&&d.videoFiles.length>0).length;if(N==="edit"){const d=a.lessons.filter(l=>l._id&&l.videoFiles&&l.videoFiles.length>0).length,v=a.lessons.filter(l=>!l._id&&l.videoFiles&&l.videoFiles.length>0).length;c=1+d+v}let m=0;if(N==="add"){const d=new FormData;if(d.append("name",a.name),d.append("description",a.description),d.append("price",a.price),d.append("instructor",a.instructor),a.image)d.append("image",a.image);else{console.error("Course image is required"),alert("Please select a course image");return}a.courseVideoUrl&&d.append("videoUrl",a.courseVideoUrl),console.log("Creating course with data:",{name:a.name,description:a.description,price:a.price,instructor:a.instructor,hasImage:!!a.image});const l=(await P(F.post("https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses",d,{headers:{"Content-Type":"multipart/form-data"}}))).data._id;m+=1,z(Math.round(m/Math.max(c,1)*100));for(const x of a.lessons)if(x.videoFiles&&x.videoFiles.length>0){const i=new FormData;i.append("lessonNumber",x.lessonNumber),i.append("lessonIntro",x.lessonIntro),x.videoFiles.forEach((I,he)=>{i.append("video",I)}),await P(F.post(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${l}/lessons`,i,{headers:{"Content-Type":"multipart/form-data"}})),m+=1,z(Math.round(m/Math.max(c,1)*100))}}else if(N==="edit"){const d=h._id;try{const v=new FormData;v.append("name",a.name),v.append("description",a.description),v.append("price",a.price),v.append("instructor",a.instructor),a.image&&v.append("image",a.image),await P(F.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${d}`,v,{headers:{"Content-Type":"multipart/form-data"}})),m+=1,z(Math.round(m/Math.max(c,1)*100));for(const l of a.lessons)if(console.log(`🔍 Processing lesson: ${l.lessonNumber}, hasVideoFiles: ${!!((o=l.videoFiles)!=null&&o.length)}, lessonId: ${l._id}`),l._id)if(l.videoFiles&&l.videoFiles.length>0){const x=new FormData;x.append("lessonNumber",l.lessonNumber),x.append("lessonIntro",l.lessonIntro),console.log(`📹 Processing existing lesson ${l.lessonNumber} with ${l.videoFiles.length} video files`),l.videoFiles.forEach((i,I)=>{console.log(`📁 File ${I}:`,{hasUrl:!!i.url,name:i.name,size:i.size,type:i.type}),i.url?(console.log(`✅ Sending existing video URL: ${i.url}`),x.append("videoUrls",i.url)):(console.log(`📤 Uploading new video file: ${i.name}`),x.append("video",i))}),console.log(`🔄 Updating existing lesson ${l._id}...`),await P(F.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${l._id}`,x,{headers:{"Content-Type":"multipart/form-data"}})),m+=1,z(Math.round(m/Math.max(c,1)*100))}else console.log(`⏭️ Skipping lesson ${l.lessonNumber} - no video files to update`);else if(l.videoFiles&&l.videoFiles.length>0){const x=new FormData;x.append("lessonNumber",l.lessonNumber),x.append("lessonIntro",l.lessonIntro),console.log(`📹 Processing new lesson ${l.lessonNumber} with ${l.videoFiles.length} video files`),l.videoFiles.forEach((i,I)=>{console.log(`📁 File ${I}:`,{hasUrl:!!i.url,name:i.name,size:i.size,type:i.type}),i.url?(console.log(`✅ Sending existing video URL: ${i.url}`),x.append("videoUrls",i.url)):(console.log(`📤 Uploading new video file: ${i.name}`),x.append("video",i))}),console.log(`➕ Creating new lesson for course ${d}...`),await P(F.post(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${d}/lessons`,x,{headers:{"Content-Type":"multipart/form-data"}})),m+=1,z(Math.round(m/Math.max(c,1)*100))}else console.log(`⏭️ Skipping new lesson ${l.lessonNumber} - no video files to add`);if(h.lessons){const l=a.lessons.filter(i=>i._id).map(i=>i._id),x=h.lessons.filter(i=>!l.includes(i._id));for(const i of x)console.log(`Deleting lesson ${i._id}`),await P(F.delete(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${i._id}`))}console.log("Course updated successfully")}catch(v){console.error("Error updating course:",v),alert("There was an error updating the course. Please try again.")}}N==="add"?(alert("Course added successfully!"),w({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videoFiles:[],lessonNumber:"",lessonIntro:""}]})):N==="edit"&&alert("Course updated successfully!"),T(!1),console.log("Refreshing course list..."),await me(),console.log("Course list refreshed successfully")}catch(f){console.error("Error saving course:",f),alert("Error saving course. Please check the console for details.")}finally{$e(!1)}},ue=s=>{ze(s)},U=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,o)).toFixed(2))+" "+r[o]},rs=s=>s<60?`${Math.round(s)}s`:s<3600?`${Math.round(s/60)}m ${Math.round(s%60)}s`:`${Math.round(s/3600)}h ${Math.round(s%3600/60)}m`;return u.useEffect(()=>{console.log("Management component rendered, courses:",S.length,"loading:",G,"error:",X)},[S,G,X]),e.jsxs("div",{className:"h-screen p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Course Management"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:Ze,className:"bg-black text-white px-4 py-2 rounded",children:"Add New Course"})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-x-auto",children:G?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"Loading courses..."})}):X?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:X}),e.jsx("button",{onClick:me,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Retry"})]}):S.length===0?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No courses found. Add your first course!"})}):e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800 text-white",children:[e.jsx("th",{className:"w-16 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Image"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Instructor"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Videos"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Lessons"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"w-32 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:He.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-100 transition-colors duration-200",children:[e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",s._id.substring(0,6)]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx(xe,{image:s.image,name:s.name})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:((t=s.instructor)==null?void 0:t.name)||s.instructor||"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-indigo-600",children:s.lessons.reduce((r,o)=>r+(o.videoUrls?o.videoUrls.length:0),0)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-indigo-600",children:s.lessons.length}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-bold text-gray-900",children:["₹ ",s.price]}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-right text-sm font-medium space-x-3",children:[e.jsx("button",{onClick:()=>es(s),className:"text-indigo-600 hover:text-indigo-900",children:e.jsx(as,{size:18})}),e.jsx("button",{onClick:()=>Ke(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(ns,{size:18})}),e.jsx("button",{onClick:()=>ss(s._id),className:"text-red-600 hover:text-red-900",children:e.jsx(Be,{size:18})})]})]},s._id)})})]})}),e.jsx("div",{className:"flex lg:justify-end justify start mt-4 mb-4 pr-4",children:e.jsxs("nav",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>ue(Math.max(1,M-1)),disabled:M===1,className:`px-3 py-1 mx-1 rounded ${M===1?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Previous"}),Array.from({length:ee},(s,t)=>t+1).map(s=>e.jsx("button",{onClick:()=>ue(s),className:`px-3 py-1 mx-1 rounded ${M===s?"bg-black text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:s},s)),e.jsx("button",{onClick:()=>ue(Math.min(ee,M+1)),disabled:M===ee,className:`px-3 py-1 mx-1 rounded ${M===ee?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Next"})]})}),_e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg shadow-xl transform transition-all overflow-y-auto max-h-[85vh] relative",children:[e.jsx("button",{onClick:()=>T(!1),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-800 text-left",children:N==="view"?"Course Details":N==="add"?"Add New Course":"Edit Course"}),N==="view"&&h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Image"}),e.jsx(xe,{image:h.image,name:h.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Name"}),e.jsx("p",{children:h.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"About Guru"}),e.jsx("p",{children:h.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Instructor"}),e.jsx("p",{children:((Se=h.instructor)==null?void 0:Se.name)||h.instructor||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Price"}),e.jsxs("p",{children:["₹",h.price]})]}),h.videoUrl&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Preview Video"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 truncate",children:h.videoUrl}),e.jsx("div",{className:"relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("video",{src:h.videoUrl,controls:!0,className:"absolute inset-0 w-full h-full object-cover",preload:"metadata",children:"Your browser does not support the video tag."})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Lessons"}),e.jsx("ul",{className:"list-disc pl-5",children:(Ue=h==null?void 0:h.lessons)==null?void 0:Ue.map((s,t)=>e.jsxs("li",{children:["Lesson ",s.lessonNumber,": ",s.lessonIntro]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 mt-2",children:(ke=h==null?void 0:h.lessons)==null?void 0:ke.flatMap(s=>{var t;return(t=s.videoUrls)==null?void 0:t.map((r,o)=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:[s.lessonNumber," - Video ",o+1]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:r})]}),e.jsx("div",{className:"relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("video",{src:r,controls:!0,className:"absolute inset-0 w-full h-full object-cover",preload:"metadata",children:"Your browser does not support the video tag."})})]},o))})}),(!(h!=null&&h.lessons)||h.lessons.length===0||h.lessons.every(s=>!s.videoUrls||s.videoUrls.length===0))&&e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"No videos available for this course."})]}),e.jsx("button",{onClick:()=>T(!1),className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Close"})]}):e.jsxs("form",{onSubmit:ts,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Course Image"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:D,className:"mt-1"}),N==="edit"&&a.currentImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current image:"}),e.jsx(xe,{image:a.currentImage,name:a.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Course Name"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:D,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"About Guru"}),e.jsx("textarea",{name:"description",value:a.description,onChange:D,rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Instructor"}),e.jsxs("select",{name:"instructor",value:a.instructor,onChange:D,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:re?"Loading instructors...":"Select an instructor"}),Z&&e.jsx("option",{value:"",disabled:!0,children:Z}),!re&&!Z&&fe.length===0&&e.jsx("option",{value:"",disabled:!0,children:"No instructors found"}),!re&&!Z&&fe.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Price"}),e.jsx("input",{type:"number",name:"price",value:a.price,onChange:D,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Lessons"}),a.lessons.map((s,t)=>e.jsxs("div",{className:"mt-4 p-4 border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"text-lg font-medium text-left",children:["Lesson ",t+1]}),e.jsx("button",{type:"button",onClick:()=>Xe(t),className:"text-red-600 hover:text-red-800",children:e.jsx(ls,{})})]}),e.jsx("input",{type:"text",placeholder:"Lesson Number",value:s.lessonNumber,onChange:r=>D(r,t),name:"lessonNumber",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2",required:!0}),e.jsx("input",{type:"text",placeholder:"Lesson Intro",value:s.lessonIntro,onChange:r=>D(r,t),name:"lessonIntro",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Video Files (Up to 10GB each)"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{type:"file",accept:"video/*",multiple:!0,onChange:r=>Oe(t,r),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Upload multiple video files. Each file can be up to 10GB. Formats: MP4, AVI, MOV, etc."})]}),Object.keys(Ne).some(r=>r.startsWith(`lesson-${t}-`))&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Uploading Videos..."}),Object.keys(Ne).filter(r=>r.startsWith(`lesson-${t}-`)).map(r=>e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"📹 Uploading video..."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:[we[r]||0,"%"]}),e.jsx("button",{onClick:()=>We(r),className:"text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded transition-colors",title:"Cancel upload",children:"✕ Cancel"})]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 mb-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${we[r]||0}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs text-blue-600",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Uploaded:"}),e.jsx("span",{children:U(Re[r]||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Size:"}),e.jsx("span",{children:U(Ve[r]||0)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Speed:"}),e.jsx("span",{children:ye[r]?`${U(ye[r])}/s`:"0 B/s"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"ETA:"}),e.jsx("span",{children:Fe[r]?rs(Fe[r]):"Calculating..."})]})]})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-500",children:[e.jsx("span",{children:"🔄 Upload in progress..."}),e.jsxs("span",{children:["⏱️ Started: ",new Date().toLocaleTimeString()]})]})})]},r))]}),s.videoFiles&&s.videoFiles.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Added Videos (",s.videoFiles.length,"):"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 bg-blue-100 px-2 py-1 rounded",children:["Total: ",(s.videoFiles||[]).reduce((r,o)=>r+(o.size||0),0)>1024*1024*1024?`${((s.videoFiles||[]).reduce((r,o)=>r+(o.size||0),0)/(1024*1024*1024)).toFixed(2)} GB`:`${((s.videoFiles||[]).reduce((r,o)=>r+(o.size||0),0)/(1024*1024)).toFixed(2)} MB`]}),s.videoFiles.length>1&&e.jsx("button",{type:"button",onClick:()=>Ge(t),className:"text-xs text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-50 transition-colors",title:"Clear all videos",children:"Clear All"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto",children:s.videoFiles.map((r,o)=>{var f;return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded border hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm text-gray-600 truncate font-medium",children:[r.name,r.url&&e.jsx("span",{className:"ml-2 text-green-600 font-semibold",children:"(Existing)"}),!r.url&&e.jsx("span",{className:"ml-2 text-blue-600 font-semibold",children:"(New)"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:(r.size||0)>1024*1024*1024?`${((r.size||0)/(1024*1024*1024)).toFixed(2)} GB`:`${((r.size||0)/(1024*1024)).toFixed(2)} MB`}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500",children:((f=(r.type||"").split("/")[1])==null?void 0:f.toUpperCase())||"VIDEO"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:["#",o+1]}),e.jsx("button",{type:"button",onClick:()=>qe(t,o),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50 transition-colors",title:"Remove video",children:e.jsx(Be,{size:14})})]})]},o)})})]})]})]},t)),e.jsxs("button",{type:"button",onClick:Qe,className:"mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:[e.jsx(is,{className:"inline-block mr-2"})," Add Lesson"]})]}),e.jsxs("div",{className:"flex space-x-3 items-center",children:[e.jsx("button",{type:"submit",disabled:V,className:`flex-1 px-4 py-2 rounded text-white ${V?"bg-blue-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:V?`${N==="add"?"Adding":"Updating"}... ${Math.round(O)}%`:N==="add"?"Add Course":"Update Course"}),V&&e.jsx("div",{className:"w-40",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded transition-all duration-300 ease-out",style:{width:`${Math.round(O)}%`}})})}),e.jsx("button",{type:"button",onClick:()=>T(!1),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400",children:"Cancel"})]})]})]})})]})},xe=({image:S,name:H})=>{const[G,Q]=u.useState(!1);return e.jsx("img",{src:G||!S?"/placeholder.svg":`${S}`,alt:H,className:"h-10 w-10 rounded-full",onError:()=>Q(!0)})};export{xs as default};
