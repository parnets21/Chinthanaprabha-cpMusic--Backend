import{j as e,i as ss,k as ts,f as Ie,l as rs,F as os}from"../assets/index-EwtQ2eEo.js";import{r as d}from"./chunk-CTJ-xxG2.js";import{a as N}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const ms=()=>{var we,Fe,Ce;const[y,z]=d.useState([]),[V,O]=d.useState(!0),[q,de]=d.useState(""),[me,ue]=d.useState([]),[X,he]=d.useState(!1),[G,pe]=d.useState(""),[Pe,$]=d.useState(!1),[b,Z]=d.useState(""),[u,K]=d.useState(null),[o,v]=d.useState({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videoFiles:[],lessonNumber:"",lessonIntro:""}]}),[xe,ee]=d.useState({}),[ge,I]=d.useState({}),[fe,P]=d.useState({}),[be,T]=d.useState({}),[Te,A]=d.useState({}),[Ae,se]=d.useState({}),[W,te]=d.useState({}),[D,ve]=d.useState(!1),[re,L]=d.useState(0),[B,je]=d.useState(0),[F,De]=d.useState(1),[oe]=d.useState(5);d.useEffect(()=>{ae(),Re()},[]),d.useEffect(()=>()=>{Object.keys(W).forEach(s=>{const t=W[s];t&&(t.abort(),console.log(`Cancelled upload ${s} on component unmount`))})},[W]);const Ne=async(s,t,r,a=0)=>{var h,c,m,p,_,le,Ee,Se,$e,ke,Me;const i=Date.now(),l=s.size;ee(n=>({...n,[t]:!0})),I(n=>({...n,[t]:0})),P(n=>({...n,[t]:0})),T(n=>({...n,[t]:0})),A(n=>({...n,[t]:0})),se(n=>({...n,[t]:l}));try{const n=new FormData;n.append("video",s),console.log(`Uploading ${s.name} (${E(l)}) - Attempt ${a+1}/4`);const g=new AbortController;te(S=>({...S,[t]:g}));const ie=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Y=new EventSource(`https://cpsangeetha.com/api/upload-progress/${ie}`);Y.onmessage=S=>{try{const f=JSON.parse(S.data);if(f.type==="progress"){const M=f.progress,j=M.uploadedBytes,H=M.totalBytes,R=M.percentage,Ue=(Date.now()-i)/1e3,Q=j/Ue,es=(H-j)/Q;I(U=>({...U,[t]:R})),P(U=>({...U,[t]:Q})),T(U=>({...U,[t]:es})),A(U=>({...U,[t]:j})),console.log(`📊 SSE Progress for ${s.name}: ${R}% (${E(j)}/${E(H)})`)}else{if(f.type==="completed")return console.log("🎉 Upload completed via SSE:",f),Y.close(),f.videoUrl;f.type==="connected"&&console.log("📡 SSE connected for upload:",ie)}}catch(f){console.error("Error parsing SSE data:",f)}},Y.onerror=S=>{console.error("SSE connection error:",S),Y.close()};const Ze=N.create({timeout:7200*1e3,headers:{"Content-Type":"multipart/form-data"},signal:g.signal,onUploadProgress:S=>{const f=S.loaded,M=S.total,j=Math.round(f*100/M),H=(Date.now()-i)/1e3,R=f/H,Q=(M-f)/R;if(I(w=>({...w,[t]:j})),P(w=>({...w,[t]:R})),T(w=>({...w,[t]:Q})),A(w=>({...w,[t]:f})),j%10===0&&j>0&&console.log(`Upload progress for ${s.name}: ${j}% (${E(f)}/${E(M)})`),j>0&&j<100)try{fetch("https://cpsangeetha.com/api/heartbeat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({timestamp:Date.now()})}).catch(()=>{})}catch{}}});n.append("uploadId",ie);const Ke=await Ze.post(r,n);return console.log(`Successfully uploaded ${s.name}`),Ke.data.location}catch(n){if(console.error(`Upload attempt ${a+1} failed for ${s.name}:`,n),n.name==="AbortError"||n.code==="ERR_CANCELED")throw console.log(`Upload cancelled for ${s.name}`),new Error("Upload cancelled by user");if(a<3&&(n.code==="ECONNABORTED"||n.code==="ECONNRESET"||n.code==="ETIMEDOUT"||((h=n.response)==null?void 0:h.status)===500||((c=n.response)==null?void 0:c.status)===502||((m=n.response)==null?void 0:m.status)===503||((p=n.response)==null?void 0:p.status)===504||(_=n.message)!=null&&_.includes("timeout")||(le=n.message)!=null&&le.includes("Network Error")))return console.log(`Retrying upload for ${s.name} in 5 seconds... (Attempt ${a+2}/4)`),I(g=>({...g,[t]:0})),P(g=>({...g,[t]:0})),T(g=>({...g,[t]:0})),A(g=>({...g,[t]:0})),await new Promise(g=>setTimeout(g,5e3)),Ne(s,t,r,a+1);throw n.code==="ECONNABORTED"||(Ee=n.message)!=null&&Ee.includes("timeout")?new Error("Upload timeout - file too large or connection too slow. Please check your internet connection and try again."):n.code==="ECONNRESET"?new Error("Connection lost during upload. Please try again."):((Se=n.response)==null?void 0:Se.status)===413?new Error("File too large - maximum size is 10GB"):(($e=n.response)==null?void 0:$e.status)>=500?new Error("Server error during upload - please try again in a few minutes"):((ke=n.response)==null?void 0:ke.status)===400?new Error("Invalid file format - please upload a video file"):(Me=n.message)!=null&&Me.includes("Network Error")?new Error("Network error - please check your internet connection"):new Error(`Upload failed: ${n.message}`)}finally{ee(n=>({...n,[t]:!1})),te(n=>{const g={...n};return delete g[t],g}),setTimeout(()=>{I(n=>({...n,[t]:0})),P(n=>({...n,[t]:0})),T(n=>({...n,[t]:0})),A(n=>({...n,[t]:0})),se(n=>({...n,[t]:0}))},5e3)}},Le=async(s,t)=>{try{const r=Array.from(t.target.files);if(!r.length)return;const a=[],x=[];if(r.forEach(i=>{if(!i.type.startsWith("video/")){x.push(`${i.name} - Not a video file`);return}if(i.size>10*1024*1024*1024){x.push(`${i.name} - File too large (max 10GB)`);return}a.push(i)}),x.length>0&&alert(`Invalid files:
${x.join(`
`)}`),a.length>0){const i=[];for(let l=0;l<a.length;l++){const h=a[l],c=`lesson-${s}-file-${l}`;try{const m=await Ne(h,c,"https://cpsangeetha.com/chinthanaprabha/upload-video-direct");i.push({...h,url:m})}catch(m){console.error(`Failed to upload ${h.name}:`,m),alert(`Failed to upload ${h.name}. Please try again.`)}}i.length>0&&(v(l=>({...l,lessons:l.lessons.map((h,c)=>c===s?{...h,videoFiles:[...h.videoFiles||[],...i]}:h)})),i.length===1?alert(`Successfully uploaded: ${i[0].name}`):alert(`Successfully uploaded ${i.length} video files`))}t.target.value=""}catch(r){console.error("Error handling video file change:",r),alert("Error adding video files. Please try again.")}},Be=(s,t)=>{try{v(r=>({...r,lessons:r.lessons.map((a,x)=>x===s?{...a,videoFiles:(a.videoFiles||[]).filter((i,l)=>l!==t)}:a)}))}catch(r){console.error("Error removing video file:",r),alert("Error removing video file. Please try again.")}},_e=s=>{try{window.confirm("Are you sure you want to remove all videos from this lesson?")&&v(t=>({...t,lessons:t.lessons.map((r,a)=>a===s?{...r,videoFiles:[]}:r)}))}catch(t){console.error("Error clearing all videos:",t),alert("Error clearing videos. Please try again.")}},Ve=s=>{try{const t=W[s];t&&(t.abort(),console.log(`Upload cancelled for ${s}`),ee(r=>({...r,[s]:!1})),I(r=>({...r,[s]:0})),P(r=>({...r,[s]:0})),T(r=>({...r,[s]:0})),A(r=>({...r,[s]:0})),se(r=>({...r,[s]:0})),te(r=>{const a={...r};return delete a[s],a}),alert("Upload cancelled successfully"))}catch(t){console.error("Error cancelling upload:",t),alert("Error cancelling upload. Please try again.")}},C=async s=>{try{const t=await s;return console.log("API Response:",t.data),t}catch(t){throw console.error("API Error:",t.response?t.response.data:t.message),t}};d.useEffect(()=>{if(!D)return;let s,t=performance.now();const r=a=>{const x=Math.min(1e3,a-t);t=a;const i=re>=95?100:95,l=Math.max(re,Math.min(i,B+x/1e3*3)),h=B+(l-B)*.2;je(h),s=requestAnimationFrame(r)};return s=requestAnimationFrame(r),()=>cancelAnimationFrame(s)},[D,re,B]);const ae=async()=>{try{console.log("Starting to fetch courses..."),O(!0),de("");const s=await C(N.get("https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses"));console.log("Courses fetched successfully:",s.data,"courses"),z(s.data)}catch(s){console.error("Error fetching courses:",s),de("Failed to load courses")}finally{O(!1)}},Re=async()=>{var s,t;try{he(!0),pe("");const r=await C(N.get("https://cpsangeetha.com/chinthanaprabha/teacher-auth/teachers"));ue(r.data||[])}catch(r){console.error("Error fetching teachers:",r),pe(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load instructors"),ue([])}finally{he(!1)}},ye=F*oe,ze=ye-oe,Oe=y.slice(ze,ye),J=Math.ceil(y.length/oe),k=async(s,t=-1)=>{const{name:r,value:a,type:x,files:i}=s.target;if(x==="file")r==="image"?v({...o,[r]:i[0]}):r==="courseVideo"&&console.log("Course video upload functionality has been removed");else if(t===-1)v({...o,[r]:a});else{const l=[...o.lessons];l[t][r]=a,v({...o,lessons:l})}},qe=()=>{v({...o,lessons:[...o.lessons,{videoFiles:[],lessonNumber:"",lessonIntro:""}]})},Ge=s=>{const t=o.lessons.filter((r,a)=>a!==s);v({...o,lessons:t})},We=()=>{Z("add"),K(null),v({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videoUrls:[],lessonNumber:"",lessonIntro:""}]}),$(!0)},Je=s=>{var r;console.log("Editing course:",s);const t=s.lessons.map(a=>({lessonNumber:a.lessonNumber||"",lessonIntro:a.lessonIntro||"",videoFiles:[],_id:a._id}));v({name:s.name||"",description:s.description||"",price:s.price||"",instructor:((r=s.instructor)==null?void 0:r._id)||s.instructor||"",image:null,currentImage:s.image,lessons:t.length>0?t:[{videoFiles:[],lessonNumber:"",lessonIntro:""}]}),K(s),Z("edit"),$(!0)},Ye=s=>{K({...s}),Z("view"),$(!0)},He=async s=>{if(confirm("Are you sure you want to delete this course?"))try{await N.delete(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${s}`),z(y.filter(t=>t._id!==s))}catch(t){console.error("Error deleting course:",t)}},Qe=async s=>{var t,r;if(s.preventDefault(),!o.name||!o.description||!o.price||!o.instructor){alert("Please fill in all required fields (Name, Description, Price, Instructor)");return}if(!o.image){alert("Please select a course image");return}console.log("Form data validation passed:",{name:o.name,description:o.description,price:o.price,instructor:o.instructor,hasImage:!!o.image,imageType:(t=o.image)==null?void 0:t.type,imageSize:(r=o.image)==null?void 0:r.size});try{ve(!0),L(0),je(0);let x=1+o.lessons.filter(l=>l.videoFiles&&l.videoFiles.length>0).length;if(b==="edit"){const l=o.lessons.filter(c=>c._id&&c.videoFiles&&c.videoFiles.length>0).length,h=o.lessons.filter(c=>!c._id&&c.videoFiles&&c.videoFiles.length>0).length;x=1+l+h}let i=0;if(b==="add"){const l=new FormData;if(l.append("name",o.name),l.append("description",o.description),l.append("price",o.price),l.append("instructor",o.instructor),o.image)l.append("image",o.image);else{console.error("Course image is required"),alert("Please select a course image");return}o.courseVideoUrl&&l.append("videoUrl",o.courseVideoUrl),console.log("Creating course with data:",{name:o.name,description:o.description,price:o.price,instructor:o.instructor,hasImage:!!o.image});const c=(await C(N.post("https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses",l,{headers:{"Content-Type":"multipart/form-data"}}))).data._id;i+=1,L(Math.round(i/Math.max(x,1)*100));for(const m of o.lessons)if(m.videoFiles&&m.videoFiles.length>0){const p=new FormData;p.append("lessonNumber",m.lessonNumber),p.append("lessonIntro",m.lessonIntro),m.videoFiles.forEach((_,le)=>{p.append("video",_)}),await C(N.post(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${c}/lessons`,p,{headers:{"Content-Type":"multipart/form-data"}})),i+=1,L(Math.round(i/Math.max(x,1)*100))}}else if(b==="edit"){const l=u._id;try{const h=new FormData;h.append("name",o.name),h.append("description",o.description),h.append("price",o.price),h.append("instructor",o.instructor),o.image&&h.append("image",o.image),await C(N.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${l}`,h,{headers:{"Content-Type":"multipart/form-data"}})),i+=1,L(Math.round(i/Math.max(x,1)*100));for(const c of o.lessons)if(c._id){if(c.videoFiles&&c.videoFiles.length>0){const m=new FormData;m.append("lessonNumber",c.lessonNumber),m.append("lessonIntro",c.lessonIntro),c.videoFiles.forEach((p,_)=>{p.url?m.append("videoUrls",p.url):m.append("video",p)}),await C(N.put(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${c._id}`,m,{headers:{"Content-Type":"multipart/form-data"}})),i+=1,L(Math.round(i/Math.max(x,1)*100))}}else if(c.videoFiles&&c.videoFiles.length>0){const m=new FormData;m.append("lessonNumber",c.lessonNumber),m.append("lessonIntro",c.lessonIntro),c.videoFiles.forEach((p,_)=>{p.url?m.append("videoUrls",p.url):m.append("video",p)}),await C(N.post(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/courses/${l}/lessons`,m,{headers:{"Content-Type":"multipart/form-data"}})),i+=1,L(Math.round(i/Math.max(x,1)*100))}if(u.lessons){const c=o.lessons.filter(p=>p._id).map(p=>p._id),m=u.lessons.filter(p=>!c.includes(p._id));for(const p of m)console.log(`Deleting lesson ${p._id}`),await C(N.delete(`https://cpsangeetha.com/chinthanaprabha/courses-lessons/lessons/${p._id}`))}console.log("Course updated successfully")}catch(h){console.error("Error updating course:",h),alert("There was an error updating the course. Please try again.")}}b==="add"?(alert("Course added successfully!"),v({name:"",description:"",price:"",instructor:"",image:null,lessons:[{videoFiles:[],lessonNumber:"",lessonIntro:""}]})):b==="edit"&&alert("Course updated successfully!"),$(!1),console.log("Refreshing course list..."),await ae(),console.log("Course list refreshed successfully")}catch(a){console.error("Error saving course:",a),alert("Error saving course. Please check the console for details.")}finally{ve(!1)}},ne=s=>{De(s)},E=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(2))+" "+r[a]},Xe=s=>s<60?`${Math.round(s)}s`:s<3600?`${Math.round(s/60)}m ${Math.round(s%60)}s`:`${Math.round(s/3600)}h ${Math.round(s%3600/60)}m`;return d.useEffect(()=>{console.log("Management component rendered, courses:",y.length,"loading:",V,"error:",q)},[y,V,q]),e.jsxs("div",{className:"h-screen p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Course Management"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:We,className:"bg-black text-white px-4 py-2 rounded",children:"Add New Course"})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-x-auto",children:V?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"Loading courses..."})}):q?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:q}),e.jsx("button",{onClick:ae,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Retry"})]}):y.length===0?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No courses found. Add your first course!"})}):e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800 text-white",children:[e.jsx("th",{className:"w-16 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Image"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Instructor"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Videos"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Lessons"}),e.jsx("th",{className:"w-20 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"w-32 px-4 py-2 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:Oe.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-100 transition-colors duration-200",children:[e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",s._id.substring(0,6)]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx(ce,{image:s.image,name:s.name})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:((t=s.instructor)==null?void 0:t.name)||s.instructor||"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-indigo-600",children:s.lessons.reduce((r,a)=>r+(a.videoUrls?a.videoUrls.length:0),0)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-indigo-600",children:s.lessons.length}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-bold text-gray-900",children:["₹ ",s.price]}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap text-right text-sm font-medium space-x-3",children:[e.jsx("button",{onClick:()=>Ye(s),className:"text-indigo-600 hover:text-indigo-900",children:e.jsx(ss,{size:18})}),e.jsx("button",{onClick:()=>Je(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(ts,{size:18})}),e.jsx("button",{onClick:()=>He(s._id),className:"text-red-600 hover:text-red-900",children:e.jsx(Ie,{size:18})})]})]},s._id)})})]})}),e.jsx("div",{className:"flex lg:justify-end justify start mt-4 mb-4 pr-4",children:e.jsxs("nav",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>ne(Math.max(1,F-1)),disabled:F===1,className:`px-3 py-1 mx-1 rounded ${F===1?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Previous"}),Array.from({length:J},(s,t)=>t+1).map(s=>e.jsx("button",{onClick:()=>ne(s),className:`px-3 py-1 mx-1 rounded ${F===s?"bg-black text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:s},s)),e.jsx("button",{onClick:()=>ne(Math.min(J,F+1)),disabled:F===J,className:`px-3 py-1 mx-1 rounded ${F===J?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Next"})]})}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg shadow-xl transform transition-all overflow-y-auto max-h-[85vh] relative",children:[e.jsx("button",{onClick:()=>$(!1),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-800 text-left",children:b==="view"?"Course Details":b==="add"?"Add New Course":"Edit Course"}),b==="view"&&u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Image"}),e.jsx(ce,{image:u.image,name:u.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Name"}),e.jsx("p",{children:u.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"About Guru"}),e.jsx("p",{children:u.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Instructor"}),e.jsx("p",{children:((we=u.instructor)==null?void 0:we.name)||u.instructor||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Price"}),e.jsxs("p",{children:["₹",u.price]})]}),u.videoUrl&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Course Preview Video"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 truncate",children:u.videoUrl}),e.jsx("div",{className:"relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("video",{src:u.videoUrl,controls:!0,className:"absolute inset-0 w-full h-full object-cover",preload:"metadata",children:"Your browser does not support the video tag."})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Lessons"}),e.jsx("ul",{className:"list-disc pl-5",children:(Fe=u==null?void 0:u.lessons)==null?void 0:Fe.map((s,t)=>e.jsxs("li",{children:["Lesson ",s.lessonNumber,": ",s.lessonIntro]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-left",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 mt-2",children:(Ce=u==null?void 0:u.lessons)==null?void 0:Ce.flatMap(s=>{var t;return(t=s.videoUrls)==null?void 0:t.map((r,a)=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:[s.lessonNumber," - Video ",a+1]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:r})]}),e.jsx("div",{className:"relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("video",{src:r,controls:!0,className:"absolute inset-0 w-full h-full object-cover",preload:"metadata",children:"Your browser does not support the video tag."})})]},a))})}),(!(u!=null&&u.lessons)||u.lessons.length===0||u.lessons.every(s=>!s.videoUrls||s.videoUrls.length===0))&&e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"No videos available for this course."})]}),e.jsx("button",{onClick:()=>$(!1),className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Close"})]}):e.jsxs("form",{onSubmit:Qe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Course Image"}),e.jsx("input",{type:"file",name:"image",accept:"image/*",onChange:k,className:"mt-1"}),b==="edit"&&o.currentImage&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current image:"}),e.jsx(ce,{image:o.currentImage,name:o.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Course Name"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:k,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"About Guru"}),e.jsx("textarea",{name:"description",value:o.description,onChange:k,rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Instructor"}),e.jsxs("select",{name:"instructor",value:o.instructor,onChange:k,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:X?"Loading instructors...":"Select an instructor"}),G&&e.jsx("option",{value:"",disabled:!0,children:G}),!X&&!G&&me.length===0&&e.jsx("option",{value:"",disabled:!0,children:"No instructors found"}),!X&&!G&&me.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Price"}),e.jsx("input",{type:"number",name:"price",value:o.price,onChange:k,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Lessons"}),o.lessons.map((s,t)=>e.jsxs("div",{className:"mt-4 p-4 border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"text-lg font-medium text-left",children:["Lesson ",t+1]}),e.jsx("button",{type:"button",onClick:()=>Ge(t),className:"text-red-600 hover:text-red-800",children:e.jsx(rs,{})})]}),e.jsx("input",{type:"text",placeholder:"Lesson Number",value:s.lessonNumber,onChange:r=>k(r,t),name:"lessonNumber",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2",required:!0}),e.jsx("input",{type:"text",placeholder:"Lesson Intro",value:s.lessonIntro,onChange:r=>k(r,t),name:"lessonIntro",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left",children:"Video Files (Up to 10GB each)"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{type:"file",accept:"video/*",multiple:!0,onChange:r=>Le(t,r),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Upload multiple video files. Each file can be up to 10GB. Formats: MP4, AVI, MOV, etc."})]}),Object.keys(xe).some(r=>r.startsWith(`lesson-${t}-`))&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Uploading Videos..."}),Object.keys(xe).filter(r=>r.startsWith(`lesson-${t}-`)).map(r=>e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"📹 Uploading video..."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:[ge[r]||0,"%"]}),e.jsx("button",{onClick:()=>Ve(r),className:"text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded transition-colors",title:"Cancel upload",children:"✕ Cancel"})]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 mb-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${ge[r]||0}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs text-blue-600",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Uploaded:"}),e.jsx("span",{children:E(Te[r]||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Size:"}),e.jsx("span",{children:E(Ae[r]||0)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Speed:"}),e.jsx("span",{children:fe[r]?`${E(fe[r])}/s`:"0 B/s"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"ETA:"}),e.jsx("span",{children:be[r]?Xe(be[r]):"Calculating..."})]})]})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-500",children:[e.jsx("span",{children:"🔄 Upload in progress..."}),e.jsxs("span",{children:["⏱️ Started: ",new Date().toLocaleTimeString()]})]})})]},r))]}),s.videoFiles&&s.videoFiles.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Added Videos (",s.videoFiles.length,"):"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 bg-blue-100 px-2 py-1 rounded",children:["Total: ",(s.videoFiles||[]).reduce((r,a)=>r+(a.size||0),0)>1024*1024*1024?`${((s.videoFiles||[]).reduce((r,a)=>r+(a.size||0),0)/(1024*1024*1024)).toFixed(2)} GB`:`${((s.videoFiles||[]).reduce((r,a)=>r+(a.size||0),0)/(1024*1024)).toFixed(2)} MB`]}),s.videoFiles.length>1&&e.jsx("button",{type:"button",onClick:()=>_e(t),className:"text-xs text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-50 transition-colors",title:"Clear all videos",children:"Clear All"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto",children:s.videoFiles.map((r,a)=>{var x;return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded border hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-600 truncate font-medium",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:(r.size||0)>1024*1024*1024?`${((r.size||0)/(1024*1024*1024)).toFixed(2)} GB`:`${((r.size||0)/(1024*1024)).toFixed(2)} MB`}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500",children:((x=(r.type||"").split("/")[1])==null?void 0:x.toUpperCase())||"VIDEO"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:["#",a+1]}),e.jsx("button",{type:"button",onClick:()=>Be(t,a),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50 transition-colors",title:"Remove video",children:e.jsx(Ie,{size:14})})]})]},a)})})]})]})]},t)),e.jsxs("button",{type:"button",onClick:qe,className:"mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:[e.jsx(os,{className:"inline-block mr-2"})," Add Lesson"]})]}),e.jsxs("div",{className:"flex space-x-3 items-center",children:[e.jsx("button",{type:"submit",disabled:D,className:`flex-1 px-4 py-2 rounded text-white ${D?"bg-blue-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:D?`${b==="add"?"Adding":"Updating"}... ${Math.round(B)}%`:b==="add"?"Add Course":"Update Course"}),D&&e.jsx("div",{className:"w-40",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded transition-all duration-300 ease-out",style:{width:`${Math.round(B)}%`}})})}),e.jsx("button",{type:"button",onClick:()=>$(!1),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400",children:"Cancel"})]})]})]})})]})},ce=({image:y,name:z})=>{const[V,O]=d.useState(!1);return e.jsx("img",{src:V||!y?"/placeholder.svg":`${y}`,alt:z,className:"h-10 w-10 rounded-full",onError:()=>O(!0)})};export{ms as default};
