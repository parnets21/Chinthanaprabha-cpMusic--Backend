import{j as e,S as G,R as C,X as I,V as M,a as B,T as O,b as q,Y as J}from"../assets/index-5RbimExn.js";import{r as i}from"./chunk-CTJ-xxG2.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-ngrFHoWO.js";import"./chunk-nx6VVHRj.js";const Z=()=>{const o="https://cpsangeetha.com/api/category",[g,f]=i.useState([]),[n,c]=i.useState(!1),[T,A]=i.useState({total:0}),[r,d]=i.useState({name:"",description:"",image:null}),[m,b]=i.useState(null),[S,h]=i.useState(""),[u,E]=i.useState(!1),[U,F]=i.useState(null),[D,p]=i.useState(!1),[x,L]=i.useState(""),[j,V]=i.useState("all"),y=async()=>{try{c(!0);const t=await(await fetch(`${o}`)).json();t.success&&Array.isArray(t.data)?f(t.data):(console.error("Invalid data format received:",t),f([]))}catch(s){console.error("Error fetching categories:",s),f([])}finally{c(!1)}},N=async()=>{try{const t=await(await fetch(`${o}/stats`)).json();t.success&&A(t.data)}catch(s){console.error("Error fetching stats:",s)}};i.useEffect(()=>{y(),N()},[]);const v=()=>{d({name:"",description:"",image:null}),b(null),h(""),E(!1),F(null),p(!1)},z=s=>{const t=s.target.files[0];if(t){b(t);const a=new FileReader;a.onload=l=>{h(l.target.result)},a.readAsDataURL(t)}},P=async()=>{if(!r.name||!r.image&&!m){alert("Please fill in all required fields");return}try{c(!0);const s=new FormData;s.append("name",r.name),s.append("description",r.description),s.append("trending",r.trending),r.subCategories&&s.append("subCategories",JSON.stringify(r.subCategories.split(",").map(l=>l.trim()).filter(Boolean))),m?s.append("image",m):r.image&&!u&&s.append("imageUrl",r.image);let t;u?t=await fetch(`${o}/${U}`,{method:"PUT",body:s}):t=await fetch(`${o}`,{method:"POST",body:s});const a=await t.json();a.success?(alert(a.message),v(),y(),N()):alert(a.message||"Operation failed")}catch(s){console.error("Error submitting category:",s),alert("Failed to save category")}finally{c(!1)}},$=async s=>{try{const a=await(await fetch(`${o}/${s._id||s.id}`)).json();if(a.success){const l=a.data;if(d({name:l.name,description:l.description||"",image:l.image}),l.image){const k=l.image.match(/(https?:\/\/[^\s]+)/)?l.image.match(/(https?:\/\/[^\s]+)/)[0]:"https://via.placeholder.com/400x200?text=No+Image";h(k),console.log("Image preview for edit:",k)}E(!0),F(l._id||l.id),p(!0)}}catch(t){console.error("Error fetching category details:",t),alert("Failed to load category details")}},R=async s=>{if(window.confirm("Are you sure you want to delete this category?"))try{c(!0);const a=await(await fetch(`${o}/${s}`,{method:"DELETE"})).json();a.success?(alert("Category deleted successfully"),y(),N()):alert(a.message||"Failed to delete category")}catch(t){console.error("Error deleting category:",t),alert("Failed to delete category")}finally{c(!1)}},w=Array.isArray(g)?g.filter(s=>(s.name.toLowerCase().includes(x.toLowerCase())||s.description&&s.description.toLowerCase().includes(x.toLowerCase()))&&j==="all"):[],_=s=>{if(console.log("getImageUrl input:",s),!s)return console.log("No image path, returning placeholder"),"https://via.placeholder.com/400x200?text=No+Image";const t=s.match(/(https?:\/\/[^\s]+)/);if(t){const a=t[0];return console.log("Extracted URL from imagePath:",a),a}return console.log("No valid URL found, returning placeholder"),"https://via.placeholder.com/400x200?text=No+Image"};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Category Management"})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-4 flex-1",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(G,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search categories...",className:"pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x,onChange:s=>L(s.target.value)})]})}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",disabled:n,children:[e.jsx(C,{size:20}),"Add Category"]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:u?"Edit Category":"Add New Category"}),e.jsx("button",{onClick:v,className:"text-gray-400 hover:text-gray-600",children:e.jsx(I,{size:24})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:r.name,onChange:s=>d({...r,name:s.target.value}),placeholder:"Enter category name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Image *"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:z,className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]}),S&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preview"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:S,alt:"Preview",className:"h-32 w-64 object-cover rounded-lg border shadow-sm",onError:s=>{s.target.style.display="none"}}),e.jsx("button",{onClick:()=>{b(null),h(""),d({...r,image:""})},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(I,{size:16})})]}),m&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",m.name]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",value:r.description,onChange:s=>d({...r,description:s.target.value}),placeholder:"Enter category description"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:P,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors disabled:opacity-50",disabled:n,children:[e.jsx(B,{size:20}),u?"Update Category":"Create Category"]}),e.jsx("button",{onClick:v,className:"bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:w.map(s=>{var t;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:_(s.image),alt:s.name,className:"w-full h-48 object-cover",onError:a=>{console.log("Category image failed to load:",s.image),a.target.src="https://via.placeholder.com/400x200?text=Image+Not+Found"}}),s.trending&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 flex items-center gap-1",children:[e.jsx(O,{size:14}),"Trending"]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:s.description||"No description"}),((t=s.subCategories)==null?void 0:t.length)>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.subCategories.map((a,l)=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:a},l))}),e.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>$(s),className:"flex-1 bg-blue-50 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-100 flex items-center justify-center gap-2 transition-colors",disabled:n,children:[e.jsx(q,{size:16}),"Edit"]}),e.jsxs("button",{onClick:()=>R(s._id||s.id),className:"flex-1 bg-red-50 text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 flex items-center justify-center gap-2 transition-colors",disabled:n,children:[e.jsx(J,{size:16}),"Delete"]})]})]})]},s._id||s.id)})}),w.length===0&&!n&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(C,{size:48,className:"mx-auto mb-4"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No categories found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:x||j!=="all"?"Try adjusting your search or filter criteria":"Get started by creating your first category"}),!x&&j==="all"&&e.jsxs("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 inline-flex items-center gap-2",children:[e.jsx(C,{size:20}),"Create First Category"]})]}),e.jsxs("div",{className:"mt-8 bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:T.total||(Array.isArray(g)?g.length:0)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Categories"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:w.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Filtered Results"})]})]})]})]})})};export{Z as default};
