import{j as e,a4 as ee,a5 as se,a6 as te,a7 as ae,a8 as re,a9 as le,aa as ne,ab as oe,m as F,h as T,ac as ce,ad as de,ae as ie,g as xe}from"../assets/index-5RbimExn.js";import{r as c}from"./chunk-CTJ-xxG2.js";import{a as D}from"./chunk-ngrFHoWO.js";import{y as m}from"./chunk-B_gl6WRw.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const je=()=>{const[j,y]=c.useState({}),[P,A]=c.useState(!0),[$,I]=c.useState(null),[n,z]=c.useState({currentPage:1,totalPages:1,totalItems:0,limit:9}),[B,b]=c.useState(!1),[R,Q]=c.useState(null),[d,G]=c.useState(""),[g,V]=c.useState(""),[i,E]=c.useState(0),[N,L]=c.useState(""),[U,Y]=c.useState(!1),[v,O]=c.useState("all"),[f,w]=c.useState("all"),u=async(s=1)=>{var a,t;try{A(!0),I(null);const r=await D.get("https://cpsangeetha.com/chinthanaprabha/practise/all",{params:{page:s,limit:n.limit}});if(!r.data||!Array.isArray(r.data.practiseVideos))throw new Error("Invalid API response structure");const o={};r.data.practiseVideos.forEach(l=>{var p,h;const x=((h=(p=l.lessonId)==null?void 0:p.course)==null?void 0:h.name)||"Uncategorized";o[x]||(o[x]=[]),o[x].push({id:l._id,videoUrl:l.videoUrl,status:l.status||"pending",rating:l.rating||0,feedback:l.feedback||"",lesson:l.lessonId?{id:l.lessonId._id,title:l.lessonId.lessonNumber,description:l.lessonId.lessonIntro,course:x}:null,user:l.userId?{id:l.userId._id,name:l.userId.name,email:l.userId.email}:null,createdAt:new Date(l.createdAt).toLocaleDateString()})}),y(o),z({currentPage:r.data.pagination.currentPage,totalPages:r.data.pagination.totalPages,totalItems:r.data.pagination.totalVideos,limit:r.data.pagination.limit})}catch(r){console.error("Error fetching videos:",r),I(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||r.message||"Failed to load videos. Please try again later."),m.error("Failed to load videos"),y({})}finally{A(!1)}},M=(s,a)=>{Q(s),G(a),b(!0),V(a==="approved"?"Great work! Approved by admin":"Needs improvement. Rejected by admin"),E(a==="approved"?4:1)},H=async()=>{var s,a;try{if(!g||g.trim()===""){m.error("Please provide feedback");return}if(d==="approved"&&i<4){m.error("Approval requires a rating of 4 or 5");return}if(d==="rejected"&&(i<1||i>3)){m.error("Rejection requires a rating between 1 and 3");return}const t=await D.put(`https://cpsangeetha.com/chinthanaprabha/practise/approve-reject/${R.id}`,{status:d,feedback:g.trim(),rating:i});t.data.message&&(m.success(t.data.message),y(r=>{const o={...r};for(const l in o)o[l]=o[l].map(x=>x.id===R.id?{...x,status:d,feedback:g.trim(),rating:i}:x);return o}),b(!1))}catch(t){console.error("Status update error:",t),m.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to update status")}};c.useEffect(()=>{u()},[]);const k=s=>{s>=1&&s<=n.totalPages&&u(s)},J=({status:s})=>{const a="px-2 py-1 rounded-full text-xs font-semibold flex items-center gap-1",t={approved:{icon:e.jsx(xe,{className:"text-green-500"}),text:"Approved",className:`${a} bg-green-50 text-green-800 border border-green-200`},rejected:{icon:e.jsx(T,{className:"text-red-500"}),text:"Rejected",className:`${a} bg-red-50 text-red-800 border border-red-200`},pending:{icon:e.jsx(ie,{className:"text-yellow-500"}),text:"Pending",className:`${a} bg-yellow-50 text-yellow-800 border border-yellow-200`}},r=t[s]||t.pending;return e.jsxs("span",{className:r.className,children:[r.icon,r.text]})},K=({rating:s})=>e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((a,t)=>e.jsx(F,{className:`${t<s?"text-yellow-400":"text-gray-200"} text-sm`},t)),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s,"/5)"]})]}),C=Object.entries(j).reduce((s,[a,t])=>{if(f!=="all"&&a!==f)return s;const r=t.filter(o=>{var l,x,p,h,_,q;if(v!=="all"&&o.status!==v)return!1;if(N){const S=N.toLowerCase(),W=(x=(l=o.user)==null?void 0:l.name)==null?void 0:x.toLowerCase().includes(S),X=(h=(p=o.user)==null?void 0:p.email)==null?void 0:h.toLowerCase().includes(S),Z=(q=(_=o.lesson)==null?void 0:_.title)==null?void 0:q.toLowerCase().includes(S);return W||X||Z}return!0});return r.length>0&&(s[a]=r),s},{});return P&&Object.keys(j).length===0?e.jsxs("div",{className:"flex justify-center items-center min-h-screen",children:[e.jsx(ee,{className:"animate-spin text-blue-500 text-2xl mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading videos..."})]}):$?e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-screen p-4",children:[e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 text-red-700 p-4 max-w-md w-full rounded-lg",children:[e.jsx("p",{className:"font-bold",children:"Error"}),e.jsx("p",{children:$})]}),e.jsx("button",{onClick:()=>u(n.currentPage),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Try Again"})]}):e.jsx("div",{className:"p-4 md:p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(se,{className:"text-blue-500"}),"Practice Videos"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.totalItems," total videos"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(te,{className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search videos...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:N,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Y(!U),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(ae,{className:"text-gray-500"}),e.jsx("span",{className:"text-sm",children:"Filters"})]}),e.jsxs("button",{onClick:()=>u(n.currentPage),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(re,{className:"text-gray-500"}),e.jsx("span",{className:"text-sm",children:"Refresh"})]})]})]})]}),e.jsx("div",{className:"mb-6 overflow-x-auto",children:e.jsxs("div",{className:"flex space-x-2 pb-2",children:[e.jsx("button",{onClick:()=>w("all"),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap ${f==="all"?"bg-blue-500 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:"All Courses"}),Object.keys(j).map(s=>e.jsx("button",{onClick:()=>w(s),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap ${f===s?"bg-blue-500 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:s},s))]})}),U&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6 border border-gray-200",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:v,onChange:s=>O(s.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})})}),Object.keys(C).length===0&&!P?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:"No videos found matching your criteria"}),e.jsx("button",{onClick:()=>{L(""),O("all"),w("all"),u(1)},className:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Reset Filters"})]}):e.jsxs(e.Fragment,{children:[Object.entries(C).map(([s,a])=>e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(le,{className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.length," video",a.length!==1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:a.map(t=>{var r,o;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow overflow-hidden flex flex-col border border-gray-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"bg-black h-48 flex items-center justify-center",children:e.jsx("video",{controls:!0,className:"w-full h-full object-contain",src:t.videoUrl,children:"Your browser does not support the video tag."})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(J,{status:t.status})})]}),e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsx("h3",{className:"font-medium text-gray-800 line-clamp-1",children:((r=t.lesson)==null?void 0:r.title)||"No lesson title"})}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600 line-clamp-1",children:((o=t.user)==null?void 0:o.name)||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600",children:t.createdAt})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(F,{className:"text-gray-400 flex-shrink-0"}),e.jsx(K,{rating:t.rating})]})]})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(t,"approved"),disabled:t.status==="approved",className:`flex-1 py-2 rounded-md text-sm font-medium transition-colors ${t.status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-50 text-green-700 hover:bg-green-100 border border-green-200"}`,children:"Approve"}),e.jsx("button",{onClick:()=>M(t,"rejected"),disabled:t.status==="rejected",className:`flex-1 py-2 rounded-md text-sm font-medium transition-colors ${t.status==="rejected"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100 border border-red-200"}`,children:"Reject"})]})})]},t.id)})})]},s)),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:d==="approved"?"Approve Video":"Reject Video"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(T,{})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Rating",e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:d==="approved"?"(Must be 4-5)":"(Must be 1-3)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>E(s),className:`text-xl ${s<=i?d==="approved"?s>=4?"text-green-500":"text-yellow-400 opacity-50":s<=3?"text-red-500":"text-gray-300 opacity-50":"text-gray-200"}`,children:e.jsx(F,{})},s))}),e.jsx("span",{className:`text-sm font-medium ${d==="approved"&&i>=4?"text-green-600":d==="rejected"&&i<=3?"text-red-600":"text-gray-600"}`,children:i>0?`${i} star${i!==1?"s":""}`:"Not rated"})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,value:g,onChange:s=>V(s.target.value),placeholder:"Enter your feedback...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:H,className:`px-4 py-2 text-white rounded-md transition-colors ${d==="approved"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:d==="approved"?"Approve":"Reject"})]})]})}),n.totalPages>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-8",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",Object.values(C).reduce((s,a)=>s+a.length,0)," of ",n.totalItems," videos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>k(n.currentPage-1),disabled:n.currentPage===1,className:`px-3 py-1.5 rounded-md flex items-center text-sm ${n.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(ce,{className:"mr-1"})," Previous"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:Math.min(5,n.totalPages)},(s,a)=>{const t=a+1;return e.jsx("button",{onClick:()=>k(t),className:`w-8 h-8 rounded-md text-sm ${n.currentPage===t?"bg-blue-500 text-white":"bg-white border border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:t},t)}),n.totalPages>5&&e.jsx("span",{className:"px-2 text-gray-500",children:"..."})]}),e.jsxs("button",{onClick:()=>k(n.currentPage+1),disabled:n.currentPage===n.totalPages,className:`px-3 py-1.5 rounded-md flex items-center text-sm ${n.currentPage===n.totalPages?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:["Next ",e.jsx(de,{className:"ml-1"})]})]})]})]})]})})};export{je as default};
