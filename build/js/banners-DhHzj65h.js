import{j as e,R as C,X as k,V as M,a as O,b as q,W as H,E as J,Y as V}from"../assets/index-BfWemoYy.js";import{r as i}from"./chunk-CTJ-xxG2.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-ngrFHoWO.js";import"./chunk-nx6VVHRj.js";const ee=()=>{const[o,j]=i.useState([]),[c,n]=i.useState(!1),[y,B]=i.useState({total:0,active:0,inactive:0}),[r,d]=i.useState({title:"",image:"",status:"active",description:"",priority:1}),[x,N]=i.useState(null),[w,h]=i.useState(""),[p,F]=i.useState(!1),[L,A]=i.useState(null),[U,b]=i.useState(!1),[g,D]=i.useState(""),[u,P]=i.useState("all"),m="https://cpsangeetha.com/api/banners",f=async()=>{try{n(!0);const s=await(await fetch(`${m}/get`)).json();console.log("Fetched banners:",s),s.success&&Array.isArray(s.data.banners)?(j(s.data.banners),console.log("Banner image URLs:",s.data.banners.map(a=>a.image))):(console.error("Invalid data format received:",s),j([]))}catch(t){console.error("Error fetching banners:",t),j([]),alert("Failed to fetch banners")}finally{n(!1)}},v=async()=>{try{const s=await(await fetch(`${m}/stats`)).json();s.success&&B(s.data)}catch(t){console.error("Error fetching stats:",t)}};i.useEffect(()=>{f(),v()},[]);const S=()=>{d({title:"",image:"",status:"active",description:"",priority:1}),N(null),h(""),F(!1),A(null),b(!1)},$=t=>{const s=t.target.files[0];if(s){N(s),console.log("Selected file:",s.name);const a=new FileReader;a.onload=l=>{h(l.target.result),console.log("Image preview URL:",l.target.result)},a.readAsDataURL(s)}},z=async()=>{if(!r.title||!r.image&&!x){alert("Please fill in all required fields");return}try{n(!0);const t=new FormData;t.append("title",r.title),t.append("description",r.description),t.append("status",r.status),t.append("priority",r.priority),x?t.append("image",x):r.image&&!p&&t.append("imageUrl",r.image);let s;p?s=await fetch(`${m}/${L}`,{method:"PUT",body:t}):s=await fetch(`${m}/add`,{method:"POST",body:t});const a=await s.json();console.log("Submit response:",a),a.success?(alert(a.message),S(),f(),v()):alert(a.message||"Operation failed")}catch(t){console.error("Error submitting banner:",t),alert("Failed to save banner")}finally{n(!1)}},T=async t=>{try{const a=await(await fetch(`${m}/${t._id||t.id}`)).json();if(console.log("Edit banner response:",a),a.success){const l=a.data;if(d({title:l.title,image:l.image,status:l.status,description:l.description||"",priority:l.priority||1}),l.image){const I=l.image.match(/(https?:\/\/[^\s]+)/)?l.image.match(/(https?:\/\/[^\s]+)/)[0]:"https://via.placeholder.com/400x200?text=No+Image";h(I),console.log("Image preview for edit:",I)}F(!0),A(l._id||l.id),b(!0)}}catch(s){console.error("Error fetching banner details:",s),alert("Failed to load banner details")}},R=async t=>{if(window.confirm("Are you sure you want to delete this banner?"))try{n(!0);const a=await(await fetch(`${m}/${t}`,{method:"DELETE"})).json();console.log("Delete response:",a),a.success?(alert("Banner deleted successfully"),f(),v()):alert(a.message||"Failed to delete banner")}catch(s){console.error("Error deleting banner:",s),alert("Failed to delete banner")}finally{n(!1)}},_=async t=>{try{n(!0);const a=await(await fetch(`${m}/${t}/toggle-status`,{method:"PATCH"})).json();console.log("Toggle status response:",a),a.success?(f(),v()):alert(a.message||"Failed to update banner status")}catch(s){console.error("Error toggling banner status:",s),alert("Failed to update banner status")}finally{n(!1)}},E=Array.isArray(o)?o.filter(t=>{const s=t.title.toLowerCase().includes(g.toLowerCase())||t.description&&t.description.toLowerCase().includes(g.toLowerCase()),a=u==="all"||t.status===u;return s&&a}):[],G=t=>{if(console.log("getImageUrl input:",t),!t)return console.log("No image path, returning placeholder"),"https://via.placeholder.com/400x200?text=No+Image";const s=t.match(/(https?:\/\/[^\s]+)/);if(s){const a=s[0];return console.log("Extracted URL from imagePath:",a),a}return console.log("No valid URL found, returning placeholder"),"https://via.placeholder.com/400x200?text=No+Image"};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Banner Management"})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 flex-1",children:[e.jsx("input",{type:"text",placeholder:"Search banners...",className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:g,onChange:t=>D(t.target.value)}),e.jsxs("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",disabled:c,children:[e.jsx(C,{size:20}),"Add Banner"]})]})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:p?"Edit Banner":"Add New Banner"}),e.jsx("button",{onClick:S,className:"text-gray-400 hover:text-gray-600",children:e.jsx(k,{size:24})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:r.title,onChange:t=>d({...r,title:t.target.value}),placeholder:"Enter banner title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Banner Image *"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:$,className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]}),w&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preview"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:w,alt:"Preview",className:"h-32 w-64 object-cover rounded-lg border shadow-sm",onError:t=>{console.log("Image preview failed to load:",w),t.target.style.display="none"}}),e.jsx("button",{onClick:()=>{N(null),h(""),d({...r,image:""})},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(k,{size:16})})]}),x&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",x.name]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",value:r.description,onChange:t=>d({...r,description:t.target.value}),placeholder:"Enter banner description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:r.status,onChange:t=>d({...r,status:t.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsx("input",{type:"number",min:"1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:r.priority,onChange:t=>d({...r,priority:parseInt(t.target.value)||1})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:z,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors disabled:opacity-50",disabled:c,children:[e.jsx(O,{size:20}),p?"Update Banner":"Create Banner"]}),e.jsx("button",{onClick:S,className:"bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-12",children:E.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:G(t.image),alt:t.title,className:"w-full h-48 object-cover",onError:s=>{console.log("Banner image failed to load:",t.image),s.target.src="https://via.placeholder.com/400x200?text=Image+Not+Found"}}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${t.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.status})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:t.description||"No description"}),e.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:["Created: ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>T(t),className:"flex-1 bg-blue-50 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-100 flex items-center justify-center gap-2 transition-colors",disabled:c,children:[e.jsx(q,{size:16}),"Edit"]}),e.jsxs("button",{onClick:()=>_(t._id||t.id),className:`flex-1 px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-colors ${t.status==="active"?"bg-orange-50 text-orange-600 hover:bg-orange-100":"bg-green-50 text-green-600 hover:bg-green-100"}`,disabled:c,children:[t.status==="active"?e.jsx(H,{size:16}):e.jsx(J,{size:16}),t.status==="active"?"Hide":"Show"]}),e.jsxs("button",{onClick:()=>R(t._id||t.id),className:"flex-1 bg-red-50 text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 flex items-center justify-center gap-2 transition-colors",disabled:c,children:[e.jsx(V,{size:16}),"Delete"]})]})]})]},t._id||t.id))}),E.length===0&&!c&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(C,{size:48,className:"mx-auto mb-4"})}),e.jsx("h3",{className:"text-2xl font-medium text-gray-900 mb-2",children:"No banners found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:g||u!=="all"?"Try adjusting your search or filter criteria":"Get started by creating your first banner"}),!g&&u==="all"&&e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 inline-flex items-center gap-2",children:[e.jsx(C,{size:20}),"Create First Banner"]})]}),e.jsxs("div",{className:"mt-8 bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.total||(Array.isArray(o)?o.length:0)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Banners"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.active||(Array.isArray(o)?o.filter(t=>t.status==="active").length:0)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:y.inactive||(Array.isArray(o)?o.filter(t=>t.status==="inactive").length:0)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Inactive"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:E.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Filtered Results"})]})]})]})]})})};export{ee as default};
