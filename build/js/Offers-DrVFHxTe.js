import{j as e,p as $,q as M,J as X,u as I,ar as w,as as J,at as Y,v as T,w as G,x as H,y as K,z as Q}from"../assets/index-CCaFrZwk.js";import{r as n}from"./chunk-CTJ-xxG2.js";import{a as F}from"./chunk-ngrFHoWO.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-nx6VVHRj.js";const u=F.create({baseURL:"https://cpsangeetha.com/chinthanaprabha",headers:{"Content-Type":"application/json"}});u.interceptors.request.use(i=>{const x=localStorage.getItem("token");return x&&(i.headers.Authorization=`Bearer ${x}`),i},i=>Promise.reject(i));const C={getAllOffers:i=>u.get(`/discount/offers${i!==void 0?`?active=${i}`:""}`),getOfferById:i=>u.get(`/discount/offers/${i}`),createOffer:i=>u.post("/discount/offers",i),updateOffer:(i,x)=>u.put(`/discount/offers/${i}`,x,{headers:{"Content-Type":"multipart/form-data"}}),deleteOffer:i=>u.delete(`/discount/offers/${i}`),getOfferByCouponCode:i=>u.get(`/discount/offers/coupon/${i}`),useCouponCode:i=>u.post(`/discount/offers/coupon/${i}/use`)},le=()=>{const[i,x]=n.useState([]),[z,h]=n.useState(!0),[A,k]=n.useState(null),[p,b]=n.useState("all"),[a,O]=n.useState(null),V=n.useRef(null),[B,g]=n.useState(!1),[m,P]=n.useState(!1),[v,o]=n.useState(!1),[s,f]=n.useState({title:"",description:"",couponCode:"",discountPercentage:"",discountAmount:"",validFrom:"",validUntil:"",isActive:!0,usageLimit:"",image:null,thumbnail:null,video:null});n.useEffect(()=>{j()},[p]);const j=async()=>{try{h(!0);const t=p==="all"?void 0:p==="active",r=await C.getAllOffers(t);x(r.data)}catch(t){console.error("Error fetching offers:",t),k("Failed to load offers. Please try again later.")}finally{h(!1)}},S=async t=>{try{h(!0);const r=await C.getOfferById(t);O(r.data)}catch(r){console.error("Error fetching offer:",r),k("Failed to load offer details. Please try again later.")}finally{h(!1)}},D=()=>{O(null)},E=()=>{P(!1),f({title:"",description:"",couponCode:"",discountPercentage:"",discountAmount:"",validFrom:"",validUntil:"",isActive:!0,usageLimit:"",image:null,thumbnail:null,video:null}),g(!0)},q=t=>{P(!0),f({id:t._id,title:t.title,description:t.description,couponCode:t.couponCode,discountPercentage:t.discountPercentage||"",discountAmount:t.discountAmount||"",validFrom:t.validFrom?new Date(t.validFrom).toISOString().split("T")[0]:"",validUntil:t.validUntil?new Date(t.validUntil).toISOString().split("T")[0]:"",isActive:t.isActive,usageLimit:t.usageLimit||"",image:null,thumbnail:null,video:null}),g(!0)},_=async t=>{if(window.confirm("Are you sure you want to delete this offer?"))try{await C.deleteOffer(t),j(),a&&a._id===t&&D()}catch(r){console.error("Error deleting offer:",r),alert("Failed to delete offer. Please try again.")}},d=t=>{const{name:r,value:c,type:l,checked:W}=t.target;f({...s,[r]:l==="checkbox"?W:c})},y=t=>{const{name:r,files:c}=t.target;c&&c.length>0&&(console.log(`File selected for ${r}:`,c[0].name),f({...s,[r]:c[0]}))},R=async t=>{var r,c;if(t.preventDefault(),o(!0),!s.title||!s.description||!s.couponCode){alert("Please fill in all required fields"),o(!1);return}if(!m&&!s.image){alert("Please upload an offer image"),o(!1);return}if(!s.discountPercentage&&!s.discountAmount){alert("Please specify either discount percentage or discount amount"),o(!1);return}if(!s.validUntil){alert("Please specify the offer expiry date"),o(!1);return}if(s.image&&!s.image.type.startsWith("image/")){alert("Please upload only image files for the offer image"),o(!1);return}if(s.thumbnail&&!s.thumbnail.type.startsWith("image/")){alert("Please upload only image files for the thumbnail"),o(!1);return}if(s.video&&!s.video.type.startsWith("video/")){alert("Please upload only video files for the video"),o(!1);return}try{const l=new FormData;l.append("title",s.title),l.append("description",s.description),l.append("couponCode",s.couponCode),s.discountPercentage&&l.append("discountPercentage",s.discountPercentage),s.discountAmount&&l.append("discountAmount",s.discountAmount),s.validFrom&&l.append("validFrom",s.validFrom),l.append("validUntil",s.validUntil),l.append("isActive",s.isActive),s.usageLimit&&l.append("usageLimit",s.usageLimit),s.image&&l.append("image",s.image),s.thumbnail&&l.append("thumbnail",s.thumbnail),s.video&&l.append("video",s.video),m?(await F.put(`https://cpsangeetha.com/chinthanaprabha/discount/offers/${s.id}`,l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")||""}`}}),alert("Offer updated successfully!")):(await F.post("https://cpsangeetha.com/chinthanaprabha/discount/offers",l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")||""}`}}),alert("Offer added successfully!")),g(!1),j()}catch(l){console.error("Error saving offer:",l),alert(`Failed to save offer: ${((c=(r=l.response)==null?void 0:r.data)==null?void 0:c.message)||l.message||"Please try again."}`)}finally{o(!1)}},N=t=>new Date(t).toLocaleDateString(),U=t=>new Date>new Date(t),L=t=>t.discountPercentage?`${t.discountPercentage}% OFF`:t.discountAmount?`$${t.discountAmount} OFF`:"Special Offer";return z&&!a?e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx($,{className:"animate-spin h-8 w-8 text-purple-600"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading..."})]}):A?e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mx-auto max-w-4xl my-8",children:e.jsx("p",{children:A})}):a?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("button",{onClick:D,className:"flex items-center text-black hover:text-purple-800",children:[e.jsx(M,{className:"mr-1"})," Back to Offers"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:a.title}),e.jsx("p",{className:"text-lg text-gray-600 mt-2",children:a.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg text-xl font-bold",children:L(a)}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Code: ",e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:a.couponCode})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-gray-600 mb-1",children:[e.jsx(X,{className:"mr-1",size:16}),e.jsx("span",{className:"text-sm",children:"Valid From"})]}),e.jsx("div",{className:"font-semibold",children:N(a.validFrom)})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-gray-600 mb-1",children:[e.jsx(I,{className:"mr-1",size:16}),e.jsx("span",{className:"text-sm",children:"Valid Until"})]}),e.jsx("div",{className:`font-semibold ${U(a.validUntil)?"text-red-600":"text-green-600"}`,children:N(a.validUntil)})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-gray-600 mb-1",children:[e.jsx(w,{className:"mr-1",size:16}),e.jsx("span",{className:"text-sm",children:"Used"})]}),e.jsxs("div",{className:"font-semibold",children:[a.usedCount," / ",a.usageLimit||"âˆž"]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-gray-600 mb-1",children:[a.isActive?e.jsx(J,{className:"mr-1",size:16}):e.jsx(Y,{className:"mr-1",size:16}),e.jsx("span",{className:"text-sm",children:"Status"})]}),e.jsx("div",{className:`font-semibold ${a.isActive?"text-green-600":"text-red-600"}`,children:a.isActive?"Active":"Inactive"})]})]})]}),a.video&&e.jsx("div",{className:"aspect-video bg-black",children:e.jsx("video",{ref:V,src:a.video,className:"w-full h-full object-contain",controls:!0,poster:a.thumbnail,onError:t=>{console.error("Video error:",t),t.target.onerror=null}})}),!a.video&&a.image&&e.jsx("div",{className:"p-6",children:e.jsx("img",{src:a.image||"/placeholder.svg",alt:a.title,className:"w-full max-h-96 object-contain rounded-lg",onError:t=>{t.target.onerror=null,t.target.src="/placeholder.svg?height=400&width=600"}})})]})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Special Offers"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Discover amazing deals and discounts"})]}),e.jsxs("button",{onClick:E,className:"flex items-center bg-gradient-to-b from-[#0D0D0D] via-[#8B0000] to-[#0D0D0D] text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(T,{className:"mr-2"})," Add Offer"]})]}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2 rounded-lg ${p==="all"?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"All Offers"}),e.jsx("button",{onClick:()=>b("active"),className:`px-4 py-2 rounded-lg ${p==="active"?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Active"}),e.jsx("button",{onClick:()=>b("inactive"),className:`px-4 py-2 rounded-lg ${p==="inactive"?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Inactive"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(t=>e.jsx("div",{className:"group",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:shadow-xl hover:-translate-y-1",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200 cursor-pointer",onClick:()=>S(t._id),children:[e.jsx("img",{src:t.image||"/placeholder.svg",alt:t.title,className:"w-full h-full object-cover",onError:r=>{r.target.onerror=null,r.target.src="/placeholder.svg?height=200&width=300"}}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:L(t)})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end",children:e.jsx("div",{className:"p-4 text-white",children:e.jsx("h3",{className:"text-xl font-semibold",children:t.title})})}),!t.isActive&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("span",{className:"bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:"INACTIVE"})}),U(t.validUntil)&&t.isActive&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("span",{className:"bg-orange-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:"EXPIRED"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"text-purple-600 mr-2"}),e.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:t.couponCode})]}),t.video&&e.jsxs("div",{className:"flex items-center text-purple-600",children:[e.jsx(G,{className:"mr-1",size:16}),e.jsx("span",{className:"text-sm",children:"Video"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"mr-1"}),e.jsxs("span",{children:["Until ",N(t.validUntil)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"mr-1"}),e.jsxs("span",{children:[t.usedCount," used"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>S(t._id),className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:"View Details"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>q(t),className:"text-blue-600 hover:text-blue-800",children:e.jsx(H,{})}),e.jsx("button",{onClick:()=>_(t._id),className:"text-red-600 hover:text-red-800",children:e.jsx(K,{})})]})]})]})]})},t._id))}),i.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"No offers found."}),e.jsxs("button",{onClick:E,className:"flex items-center mx-auto bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:[e.jsx(T,{className:"mr-1"})," Add Your First Offer"]})]}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold",children:m?"Edit Offer":"Add New Offer"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Q,{size:24})})]}),e.jsxs("form",{onSubmit:R,className:"p-6",encType:"multipart/form-data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:["Offer Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:d,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"couponCode",className:"block text-sm font-medium text-gray-700 mb-1",children:["Coupon Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"couponCode",name:"couponCode",value:s.couponCode,onChange:d,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"e.g., SAVE20, WELCOME50"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",name:"description",value:s.description,onChange:d,required:!0,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"discountPercentage",className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Percentage (%)"}),e.jsx("input",{type:"number",id:"discountPercentage",name:"discountPercentage",value:s.discountPercentage,onChange:d,min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"discountAmount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Amount ($)"}),e.jsx("input",{type:"number",id:"discountAmount",name:"discountAmount",value:s.discountAmount,onChange:d,min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"validFrom",className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid From"}),e.jsx("input",{type:"date",id:"validFrom",name:"validFrom",value:s.validFrom,onChange:d,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"validUntil",className:"block text-sm font-medium text-gray-700 mb-1",children:["Valid Until ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"validUntil",name:"validUntil",value:s.validUntil,onChange:d,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"usageLimit",className:"block text-sm font-medium text-gray-700 mb-1",children:"Usage Limit"}),e.jsx("input",{type:"number",id:"usageLimit",name:"usageLimit",value:s.usageLimit,onChange:d,min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Leave empty for unlimited"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:s.isActive,onChange:d,className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active Offer"})]})}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700 mb-1",children:["Offer Image ",!m&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:y,required:!m,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),m&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to keep the current image"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"thumbnail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Video Thumbnail"}),e.jsx("input",{type:"file",id:"thumbnail",name:"thumbnail",accept:"image/*",onChange:y,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Optional: Thumbnail for video content"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"video",className:"block text-sm font-medium text-gray-700 mb-1",children:"Promotional Video"}),e.jsx("input",{type:"file",id:"video",name:"video",accept:"video/*",onChange:y,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Optional: Upload a promotional video for this offer"})]})]}),e.jsxs("div",{className:"flex justify-end mt-8 space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin mr-2"}),m?"Updating...":"Adding..."]}):e.jsx(e.Fragment,{children:m?"Update Offer":"Add Offer"})})]})]})]})})]})};export{le as default};
