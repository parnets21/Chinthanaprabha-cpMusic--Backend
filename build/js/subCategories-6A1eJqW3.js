import{j as e,S as M,R as w,X as F,V as q,a as B,b as O,Y as J}from"../assets/index-CwaGjddK.js";import{r as l}from"./chunk-CTJ-xxG2.js";import"./chunk-DS08_OVb.js";import"./chunk-Cjtwp2vM.js";import"./chunk-ngrFHoWO.js";import"./chunk-nx6VVHRj.js";const Z=()=>{const d="https://cpsangeetha.com/api/subcategory",[x,f]=l.useState([]),[k,A]=l.useState([]),[i,c]=l.useState(!1),[U,V]=l.useState({total:0}),[r,n]=l.useState({name:"",description:"",categoryId:"",image:null}),[m,y]=l.useState(null),[S,u]=l.useState(""),[h,C]=l.useState(!1),[D,I]=l.useState(null),[L,b]=l.useState(!1),[g,z]=l.useState(""),j=async()=>{try{c(!0);const t=await(await fetch(`${d}`)).json();t.success&&Array.isArray(t.data)?f(t.data):(console.error("Invalid data format received:",t),f([]))}catch(s){console.error("Error fetching subcategories:",s),f([])}finally{c(!1)}},P=async()=>{try{const t=await(await fetch("https://cpsangeetha.com/api/category")).json();t.success&&Array.isArray(t.data)&&A(t.data)}catch(s){console.error("Error fetching categories:",s)}};l.useEffect(()=>{j(),P()},[]);const N=()=>{n({name:"",description:"",categoryId:"",image:null}),y(null),u(""),C(!1),I(null),b(!1)},T=s=>{const t=s.target.files[0];if(t){y(t);const a=new FileReader;a.onload=p=>{u(p.target.result)},a.readAsDataURL(t)}},_=async()=>{if(!r.name||!r.categoryId||!r.image&&!m){alert("Please fill in all required fields");return}try{c(!0);const s=new FormData;s.append("name",r.name),s.append("description",r.description),s.append("categoryId",r.categoryId),m?s.append("image",m):r.image&&!h&&s.append("imageUrl",r.image);let t;h?t=await fetch(`${d}/${D}`,{method:"PUT",body:s}):t=await fetch(`${d}`,{method:"POST",body:s});const a=await t.json();a.success?(alert(a.message),N(),j()):alert(a.message||"Operation failed")}catch(s){console.error("Error submitting subcategory:",s),alert("Failed to save subcategory")}finally{c(!1)}},R=async s=>{var t;try{const p=await(await fetch(`${d}/${s._id}`)).json();if(p.success){const o=p.data;if(n({name:o.name,description:o.description||"",categoryId:((t=o.category)==null?void 0:t._id)||o.categoryId,image:o.image}),o.image){const E=o.image.match(/(https?:\/\/[^\s]+)/)?o.image.match(/(https?:\/\/[^\s]+)/)[0]:"https://via.placeholder.com/400x200?text=No+Image";u(E),console.log("Image preview for edit:",E)}C(!0),I(o._id),b(!0)}}catch(a){console.error("Error fetching subcategory details:",a),alert("Failed to load subcategory details")}},$=async s=>{if(window.confirm("Are you sure you want to delete this subcategory?"))try{c(!0);const a=await(await fetch(`${d}/${s}`,{method:"DELETE"})).json();a.success?(alert("Subcategory deleted successfully"),j()):alert(a.message||"Failed to delete subcategory")}catch(t){console.error("Error deleting subcategory:",t),alert("Failed to delete subcategory")}finally{c(!1)}},v=Array.isArray(x)?x.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.description&&s.description.toLowerCase().includes(g.toLowerCase())):[],G=s=>{if(console.log("getImageUrl input:",s),!s)return console.log("No image path, returning placeholder"),"https://via.placeholder.com/400x200?text=No+Image";const t=s.match(/(https?:\/\/[^\s]+)/);if(t){const a=t[0];return console.log("Extracted URL from imagePath:",a),a}return console.log("No valid URL found, returning placeholder"),"https://via.placeholder.com/400x200?text=No+Image"};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Sub Category Management"})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-4 flex-1",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search subcategories...",className:"pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:g,onChange:s=>z(s.target.value)})]})}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",disabled:i,children:[e.jsx(w,{size:20}),"Add Subcategory"]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:h?"Edit Subcategory":"Add New Subcategory"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:e.jsx(F,{size:24})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:r.name,onChange:s=>n({...r,name:s.target.value}),placeholder:"Enter subcategory name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsxs("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:r.categoryId,onChange:s=>n({...r,categoryId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a category"}),k.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subcategory Image *"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(q,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]}),S&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preview"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:S,alt:"Preview",className:"h-32 w-64 object-cover rounded-lg border shadow-sm",onError:s=>{s.target.style.display="none"}}),e.jsx("button",{onClick:()=>{y(null),u(""),n({...r,image:""})},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(F,{size:16})})]}),m&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",m.name]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",value:r.description,onChange:s=>n({...r,description:s.target.value}),placeholder:"Enter subcategory description"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:_,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors disabled:opacity-50",disabled:i,children:[e.jsx(B,{size:20}),h?"Update Subcategory":"Create Subcategory"]}),e.jsx("button",{onClick:N,className:"bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:v.map(s=>{var t;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:G(s.image),alt:s.name,className:"w-full h-48 object-cover",onError:a=>{console.log("Subcategory image failed to load:",s.image),a.target.src="https://via.placeholder.com/400x200?text=Image+Not+Found"}})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.name}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["Category: ",((t=s.category)==null?void 0:t.name)||"Uncategorized"]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:s.description||"No description"}),e.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:["Created:"," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R(s),className:"flex-1 bg-blue-50 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-100 flex items-center justify-center gap-2 transition-colors",disabled:i,children:[e.jsx(O,{size:16}),"Edit"]}),e.jsxs("button",{onClick:()=>$(s._id),className:"flex-1 bg-red-50 text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 flex items-center justify-center gap-2 transition-colors",disabled:i,children:[e.jsx(J,{size:16}),"Delete"]})]})]})]},s._id)})}),v.length===0&&!i&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(w,{size:48,className:"mx-auto mb-4"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No subcategories found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:g?"Try adjusting your search criteria":"Get started by creating your first subcategory"}),!g&&e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 inline-flex items-center gap-2",children:[e.jsx(w,{size:20}),"Create First Subcategory"]})]}),e.jsxs("div",{className:"mt-8 bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:U.total||(Array.isArray(x)?x.length:0)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Subcategories"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:v.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Filtered Results"})]})]})]})]})})};export{Z as default};
